{% extends 'base.html' %}

{% load i18n %}
{% load bootstrap3 %}
{% load staticfiles %}

<!-------------------------------------------->
<!--      BREADCRUMB NAVIGATION             -->
<!-------------------------------------------->

{% block breadcrumb %}
<div>
    <ol class="breadcrumb icon-angle-right icon-th">
        <li class="fadeIn"> Dashboard </li>
        <li class="fadeIn"><a href="{% url 'team_list' %}" title="View Team"> Team </a></li>
        <li class="fadeIn"><a href="{% url 'user_detail' user.id %}" title="You are here"> {{ user.credit_name}} </a></li>
    </ol>
</div>
{% endblock breadcrumb %}

<!-------------------------------------------->
<!--            Main Section                -->
<!-------------------------------------------->

{% block content %}
<!-- Row One -->
<div class="row m-b-40">
    <div class="col-xs-12 col-sm-12 col-md-2 col-lg-2">
        <a class="media-left media-middle"> {% if user.display_photo %}<img class="centered h-200 w-200 m-r-40" src="{{ user.display_photo.url }}" id="user-profile-photo" alt="profile image">{% else %}{% endif %} </a>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
        <h4 class="m-t-5 m-b-10"><a href="{% url 'user_detail' user.id %}">{{ user.credit_name }}</a></h4>
        <p class="f-s-300"> <span class="color-white m-r-20">{{ user.title }}</span> | <span class="color-white m-l-20 m-r-20">{{user.organization.name}}</span> | <i class="fa fa-map-marker color-white m-l-20"></i> <span class="color-white m-r-20">{{ user.location }}</span></p>
        <p class="f-s-300"> <i class="fa fa-phone color-white"></i> <span class="color-white m-r-20">{{ user.phone }}</span> | <i class="fa fa-envelope-o color-white m-l-20"></i> <span class="color-white m-r-20">{{ user.email }}</span> </p>
        <p>
          {% if user.twitter %}<a href="{{ user.twitter }}" class="btn btn-sm btn-circle ml-1x" aria-label="twitter"><i class="fa fa-lg fa-twitter"></i></a>{% endif %}
          {% if user.github %}<a href="{{ user.github }}" class="btn btn-sm btn-circle" aria-label="github"><i class="fa fa-lg fa-github"></i></a>{% endif %}
          {% if user.instagram %}<a href="{{ user.instagram }}" class="btn btn-sm btn-circle ml-1x" aria-label="instagram"><i class="fa fa-lg fa-instagram"></i></a>{% endif %}
          {% if user.facebook %}<a href="{{ user.facebook }}" class="btn btn-sm btn-circle ml-1x" aria-label="facebook"><i class="fa fa-lg fa-facebook"></i></a>{% endif %}
          {% if user.linkedin %}<a href="{{ user.linkedin }}" class="btn btn-sm btn-circle ml-1x" aria-label="linkedin"><i class="fa fa-lg fa-linkedin-square"></i></a>{% endif %}
          {% if user.vine %}<a href="{{ user.vine }}" class="btn btn-sm btn-circle ml-1x" aria-label="vine"><i class="fa fa-lg fa-vine"></i></a>{% endif %}
        </p>
        <small class="f-s-12">{% if request.user.id == user.id or request.user.id == user.organization.owner.id %}<a href="{% url 'user_edit' pk=user.id %}" class="default">Edit Profile</a>{% endif %}</small>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-5 col-lg-5">
      <h5 class="m-t-40"> Bio</h5>
      <p>{{user.bio}}</p>
    </div>
</div>

<div class="row">
    <!-- Left Column -->
    <div class="col-xs-12 col-sm-12 col-md-10 col-lg-10" id="dashboard-left">
      {% if user_stories %}
      <table id="user-stories-list" class="table table-condensed">
        <thead>
          <tr>
            <th>Story</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          {% for story in user_stories %}
          <tr>
            <td><a href="{% url 'story_detail' story.id %}">{{ story.name }}</a></td>
            <td class="description-td">{{ story.description }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="f-s-18 subtle text-center italic m-b-40 m-t-40">Welcome to the {{ user.credit_name }}'s page. This is where you will see all of the current active content for {{ user.credit_name }}.</p>
      {% endif %}
    </div>
    <!-- Right Column -->
    <div class="col-xs-12 col-sm-12 col-md-2 col-lg-2 activity-widget-4" id="dashboard-right">
      {% if request.user.id == user.id %}
        <h4>Notes <a href="#" data-toggle="modal" data-target="#addUserNote" title="Add User Note"><i class="fa fa-plus sameline dark"></i></a></h4>
        <div id="displaynotes">
        {% for note in usernotes %}
            <div class="row">
                <div class="col-xs-12">
                  <div class="media">
                      <div class="media-body">
                          <a href="#" data-toggle="modal" data-target="#displayNote{{note.id}}"> {{ note.title }}</a>
                          <small class="f-s-14">{{ note.owner.credit_name }}</small></br>
                          <small class="color-default">{{ note.creation_date|date:'D M j g:i a' }}</small>
                      </div>
                  </div>
                </div>
            </div>
          {% endfor %}
        <small><a href="{% url 'user_notes' pk=request.user.id %}" class="link-text">See all notes...</a></small>
        </div>
    {% endif %}
    </div>

</div>

<script>
$(document).ready(function() {
    $('#user-stories-list').DataTable({
    });
} );
</script>


{% endblock %}

{% block modals %}
    <!-- Add Note Modal -->
    <div class="modal fade" id="addUserNote" tabindex="-1" role="dialog" aria-labelledby="addUserNoteModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="addUserModalLabel">Add a note for this user</h4>
          </div>
          <div class="modal-body">
            <form action="{% url 'create_user_note' %}" method="POST" class="post-form">
            {% csrf_token %}
            {% bootstrap_form usernoteform %}
            <input type="hidden" name="user" value="{{ user.pk }}" />
            <button type="submit" class="btn btn-primary">Post Note</button>
            </form>
          </div>
          <div class="modal-footer">
          </div>
        </div>
      </div>
    </div>
    <!-- END Add Note Modal -->
    <!-- Display User Note Modal -->
    {% for note in usernotes %}
    <div class="modal fade" id="displayNote{{note.id}}" tabindex="-1" role="dialog" aria-labelledby="displayNote{{note.id}}">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="addNote{{note.id}}Label">{{ note.title }}</h4>
          </div>
          <div class="modal-body dark">
            {{ note.text|linebreaksbr }}
          </div>
          <div class="modal-footer">
            <p class="tiny-text">{{ note.owner }} | {{ note.creation_date|date:'D M j g:i a' }}<p>
            <p class="tiny-text">Keywords: {% for keyword in note.keywords %}{{ keyword }}, {% endfor %}<p>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
    <!-- END Display User Note Modal -->
{% endblock %}
