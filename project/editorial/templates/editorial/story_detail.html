{% extends 'base.html' %}

{% load i18n %}
{% load bootstrap3 %}
{% load staticfiles %}
{% load embed_video_tags %}

{% block head %}
{{ webform.media }}
{% endblock %}

<!-- ================================================= -->
<!-- ================================================= -->
<!--             BREADCRUMB NAVIGATION                 -->
<!-- ================================================= -->
<!-- ================================================= -->

{% block breadcrumb %}
<div>
    <ol class="breadcrumb icon-angle-right icon-th">
        <li class="fadeIn"><a href="{% url 'dashboard' %}" title="Go to Dashboard"> Dashboard </a></li>
        <li class="fadeIn"> Content </li>
        <li class="fadeIn"><a href="{% url 'story_list' %}" title="View Story List"> Stories </a></li>
        <li class="fadeIn"><a href="{% url 'story_detail' story.id %}" title="You are Here"> {{ story.name }} </li>
    </ol>
</div>
{% endblock breadcrumb %}

<!-- ================================================= -->
<!-- ================================================= -->
<!--                   Main Section                    -->
<!-- ================================================= -->
<!-- ================================================= -->

{% block content %}

<!-- ================================================= -->
                    <!-- Messages -->
<!-- ================================================= -->

<div class="row">
  {% if messages %}
  <ul class="messages">
      {% for message in messages %}
      <div class="alert alert-success animated fadeIn" role="alert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">Ã—</span>
          <span class="sr-only">Close</span>
        </button>
        {{ message }}
        <a href="#" class="del-msg"></a>
      </div>
      {% endfor %}
  </ul>
  {% endif %}
</div>

<!-- ================================================= -->
                    <!-- Pseudo TABS -->
<!-- ================================================= -->
<div class="row">
      <div class="col-xs-12">
        <div class="bs-nav-tabs nav-tabs-default m-b-40" id="facettabs">
          <ul class="nav nav-tabs nav-animated-border-from-left nav-tabs-sticky text-center">
            <li class="nav-item"><a href="#" class="nav-link active"><p class="f-r-14 f-w-300 m-b-0">Story Detail</p></a></li>
            <li class="nav-item"><p class="f-r-14 f-w-400 m-b-0 m-l-20 m-r-10"> | </p></li>
            {% for facet in story.facet_set.all %}
            <li class="nav-item"><a href="{% url 'facet_edit' pk=facet.id story=story.id %}" class="nav-link"><p class="f-r-10 f-w-300 m-b-0">{{ facet.name }}</p></a></li>
            {% endfor %}
            <li class="nav-item"><a href="{% url 'facet_precreate' story=story.id %}" class="nav-link" title="Add a facet"><p class="f-r-12 f-w-300 m-b-0"><i class="fa fa-plus-square" aria-hidden="true"></i></p></a></li>
          </ul>
        </div>
      </div>
    </div>
<!-- ================================================= -->
                    <!-- CONTENT -->
<!-- ================================================= -->

<!-- Row One -->
<div class="row">
  <!-- Left Column -->
  <div class="col-xs-12 col-md-3 col-lg-3">
    <!-- Story Details -->
    <div id="story_details">
      <div class="row m-b-20">
        <!-- Story Edit -->
        <div class="col-xs-4 col-sm-2">
            <a href="{% url 'story_edit' story.id %}" title="Edit story details"><i class="fa fa-pencil-square-o subtle fa-lg" aria-hidden="true"></i></a>
        </div>
        <!-- Story Delete -->
        <div class="col-xs-4 col-sm-2">
          <form class="story-delete" method="GET"
                action="{% url 'story_delete' pk=story.id %}">
                <!-- onsubmit="return confirm('Do you want to delete this task?')"> -->
                {% csrf_token %}
            <a href="javascript:$('.story-delete').submit();" title="Delete the story"><i class="fa fa-trash subtle fa-lg" aria-hidden="true"></i></a>
            <!-- <input type="submit" class="btn btn-sm btn-danger-100" value="Delete"> -->
          </form>
        </div>
        <!-- Download -->
        <div class="col-xs-4 col-sm-8">
          <a data-toggle="modal" href="#downloadStory" title="Download this story"><i class="fa fa-cloud-download subtle fa-lg" aria-hidden="true"></i></a>
        </div>
      </div>
      <p class="f-s-18 f-w-400 thin m-b-20">{{ story.name }}</p>
      <p class="f-s-14 f-w-300 thin"><i>{{ story.story_description }}</i></p>
      <p class="m-b-20"><span class="f-s-14 f-w-500 subtle slim-margin m-b-10">Created:</span> <span class="sameline bright f-s-12 f-w-300">{{ story.creation_date|date:'N d, Y' }}</span></p>
      {% if story.project %}
      <a href="{% url 'project_detail' story.project.id %}" title="Go to Project detail"> <p class="f-s-14 f-w-300 thin">Project: {{ story.project.name }}</p></a>
      {% endif %}
      {% if story.series %}
      <a href="{% url 'series_detail' story.series.id %}" title="Go to Series detail"> <p class="f-s-14 f-w-300 thin">Series: {{ story.series.name }}</p></a>
      {% endif %}
      <p style="margin-left:-10px;">
        <span class="sameline subtle">{% if story.sensitive == True %} <i class="fa fa-check-square-o subtle"></i>{% else %}  <i class="fa fa-square subtle"></i>{% endif %}</span><span class="f-s-14 f-w-500 slim-margin m-b-10"> Sensitive</span>
        <br><span class="sameline subtle">{% if story.archived == True %} <i class="fa fa-check-square-o subtle"></i>{% else %}<i class="fa fa-square subtle"></i>{% endif %}</span><span class="f-s-14 f-w-500 slim-margin m-b-10"> Archive</span>
        <br><span class="sameline subtle">{% if story.collaborate == True %} <i class="fa fa-check-square-o subtle"></i>{% else %} <i class="fa fa-square subtle"></i>{% endif %}</span><span class="f-s-14 f-w-500 slim-margin m-b-10"> Collaborate</span>
        <br><span class="sameline subtle">{% if story.share == True %} <i class="fa fa-check-square-o subtle"></i>{% else %} <i class="fa fa-square subtle"></i>{% endif %}</span><span class="f-s-14 f-w-500 slim-margin m-b-10"> Share</span>
      </p>
      {% if story.collaborate == True %}
      <p class="f-s-14 f-w-500 subtle slim-margin m-b-10">Partners: </p>
      {% endif %}
          {% for collaborator in story.collaborate_with.all %}
          <p>{{ collaborator.name }}</p>
          {% endfor %}
      <p class="f-s-14 f-w-500 subtle slim-margin m-b-10">Team: </p>
      {% for user in story.team.all %}
          {% if user.display_photo %}
          <img class="img-circle m-b-5" width="24" src="{{ user.display_photo.url }}" alt="user">
          {% else %}
          <p class="tiny-text">{{ user.first_name }}</p>
          {% endif %}
      {% endfor %}
    </div>
  </div>
  <!-- End of Lef Column -->

  <!-- Middle Column -->
  <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
    <!-- Tasks -->
    {% with view.story_tasks as tasks %}
    <div class="row">
      <div class="col-xs-12">
        <h4 class="m-b-20"><a data-toggle="modal" data-target="#addStoryTask" title="Add Story Task">
          <i class="fa fa-plus sameline subtle m-r-20"></i>
        </a><a href="{% url 'story_task_list' story.id %}" title="Expand to see more">Tasks <span class="f-s-12 f-w-400 subtle"> (All tasks <i class="fa fa-long-arrow-right subtle" aria-hidden="true">)</i></span></a></h4>
      </div>
    </div>
    <div class="row m-b-50">
      <div class="col-xs-12">

        <!-- Identified Tasks -->
        <div>
          <a href="{% url 'story_task_list' story.id %}" title="Expand to see more"><p class="f-s-16 f-w-400 underline-warning underline-120">Identified <span class="subtle f-s-14 f-w-600">({{ tasks.identified_ct }})</span></p></a>
        </div>
        <div class="activity-widget-1">
          <div class="row">
            <div class="col-xs-12">
              <ul class="list-group">
                {% for task in tasks.identified|slice:":2" %}
                  {% if task.status == "Identified" %}
                    <li class="list-group-item">
                      <span class="color-warning-300 text-xs pull-right">{{ task.due_date|date:'D, N j, g:i a' }}</span>
                      <span class="pull-left">
                        {% for user in task.assigned_to.all|slice:":1" %}
                            {% if user.display_photo %}
                              <img class="media-object img-circle h-25 w-25" src="{{ user.display_photo.url }}" alt="user">
                            {% else %}
                              <img class="media-object img-circle h-25 w-25" src="{% static 'images/nophoto.jpg' %}" alt="user">
                            {% endif %}
                        {% endfor %}
                      </span>
                      {% if task.assigned_to.count > 1 %}
                      <span class="pull-left text-xs color-warning-300">+ {{ task.assigned_to.count|add:"-1" }}</span>
                      {% endif %}
                      <span class="m-l-30">
                        {% if task.important == True %}
                            <span class="label"><i class="fa fa-star" aria-hidden="true"></i></span>
                        {% else %}
                            <span class="label"><i class="fa fa-star-o" aria-hidden="true"></i></span>
                        {% endif %}
                        <a href="{% url 'task_detail'  task.id %}" title="Go to task details">{{ task.name }}</a>
                      </span>
                    </li>
                  {% endif %}
                {% endfor %}
               </ul>
             </div>
           </div>
         </div>

        <!-- In Progress Tasks -->
        <div class="m-t-20">
          <a href="{% url 'story_task_list' story.id %}" title="Expand to see more"><p class="f-s-16 f-w-400 underline-primary underline-120">In Progress <span class="subtle f-s-14 f-w-600">({{ tasks.inprogress_ct }})</span></p></a>
        </div>
        <div class="activity-widget-1">
          <div class="row">
            <div class="col-xs-12">
              <ul class="list-group">
                {% for task in tasks.inprogress|slice:":2" %}
                  {% if task.status == "In Progress"  %}
                    <li class="list-group-item">
                      <span class="color-primary-300 text-xs pull-right">{{ task.due_date|date:'D, N j, g:i a' }}</span>
                      <span class="pull-left">
                        {% for user in task.assigned_to.all|slice:":1" %}
                          {% if user.display_photo %}
                            <img class="media-object img-circle h-25 w-25" src="{{ user.display_photo.url }}" alt="user">
                          {% else %}
                            <img class="media-object img-circle h-25 w-25" src="{% static 'images/nophoto.jpg' %}" alt="user">
                          {% endif %}
                        {% endfor %}
                      </span>
                      {% if task.assigned_to.count > 1 %}
                      <span class="pull-left text-xs color-primary-300">+ {{ task.assigned_to.count|add:"-1" }}</span>
                      {% endif %}
                      <span class="m-l-30">
                        {% if task.important == True %}
                            <span class="label"><i class="fa fa-star" aria-hidden="true"></i></span>
                        {% else %}
                            <span class="label"><i class="fa fa-star-o" aria-hidden="true"></i></span>
                        {% endif %}
                        <a href="{% url 'task_detail'  task.id %}" title="Go to task details">{{ task.name }}</a>
                      </span>
                    </li>
                  {% endif %}
                {% endfor %}
               </ul>
             </div>
           </div>
         </div>

        <!-- Complete Tasks -->
        <div class="m-t-20">
          <a href="{% url 'story_task_list' story.id %}" title="Expand to see more"><p class="f-s-16 f-w-400 underline-success underline-120">Complete <span class="subtle f-s-14 f-w-600">({{ tasks.complete_ct }})</span></p></a>
        </div>
        <div class="activity-widget-1">
          <div class="row">
            <div class="col-xs-12">
              <ul class="list-group">
                {% for task in tasks.complete|slice:":2" %}
                  {% if task.status == "Complete"  %}
                    <li class="list-group-item">
                      <span class="color-success-300 text-xs pull-right">{{ task.due_date|date:'D, N j, g:i a' }}</span>
                      <span class="pull-left">
                        {% for user in task.assigned_to.all|slice:":1" %}
                          {% if user.display_photo %}
                            <img class="media-object img-circle h-25 w-25" src="{{ user.display_photo.url }}" alt="user">
                          {% else %}
                            <img class="media-object img-circle h-25 w-25" src="{% static 'images/nophoto.jpg' %}" alt="user">
                          {% endif %}
                        {% endfor %}
                      </span>
                      {% if task.assigned_to.count > 1 %}
                      <span class="pull-left text-xs color-success-300">+ {{ task.assigned_to.count|add:"-1" }}</span>
                      {% endif %}
                      <span class="m-l-30">
                        {% if task.important == True %}
                            <span class="label"><i class="fa fa-star" aria-hidden="true"></i></span>
                        {% else %}
                            <span class="label"><i class="fa fa-star-o" aria-hidden="true"></i></span>
                        {% endif %}
                        <a href="{% url 'task_detail'  task.id %}" title="Go to task details">{{ task.name }}</a>
                      </span>
                    </li>
                  {% endif %}
                {% endfor %}
               </ul>
             </div>
           </div>
         </div>

      </div>
    </div>
    {% endwith %}
  </div>
  <!-- End of Middle Column -->

  <!-- Right Column -->
  <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
    <h4 class="m-b-10">Discussion</h4>
    {% with view.story_discussion as discussion %}
    <!-- Display Comments -->
    <div class="discussion-container">
        <div class="row">
          {% for comment in discussion.comments %}
            <div class="col-md-10">
              <p class="f-s-12">{{ comment.text }} <span class="f-s-10 color-default">| {{ comment.date|date:'D, M j, g:i a' }}</span></p>
            </div>
            <div class="col-md-2">
              {% if comment.user.display_photo %}
              <a href="" title="{{ comment.user.first_name }}"><img class="media-object img-circle neg-m-l-10" width="32" src="{{ comment.user.display_photo.url }}" alt="user"></a>
              {% else %}
              {% endif %}
            </div>
          {% endfor %}
        </div>
    </div>
    <!-- Comment Form -->
    <div class="comment">
        <div class="row">
          <form action="{% url 'create_storycomment' %}" method="POST" class="post-form" role="form">
            <div class="col-xs-12">
                {% csrf_token %}
                <div class="input-group">
                  {{ discussion.form.text }}

                  {% if discussion.form.text.errors %}
                    <div class="alert alert-warning" role="alert">
                    {{ discussion.form.text.errors }}
                    </div>
                  {% endif %}
                  <!-- Hidden Inputs -->
                  <input type="hidden" name="association" value="story" />
                  <input type="hidden" name="story" value="{{ story.pk }}" />
                  <span class="input-group-btn">
                    <button id="storycommentbutton" class="btn btn-default btn-lg" type="submit" name="storycommentform"><i class="fa fa-paper-plane"></i></button>
                  </span>
                </div>
            </div>
          </form>
        </div>
    </div>
    {% endwith %}
  </div>
  <!-- End of Right Column -->
</div>
<!-- End of Row One -->

<!-- Row Two -->
<div class="row m-t-50">
  <!-- Left Column -->
  <div class="col-xs-12 col-md-4">
    <h4>Calendar</h4>
    <div id="calendar"></div>
  </div>
  <!-- End of Left Column -->
  <!-- Middle Column -->
  <div class="col-xs-12 col-md-4">
    <!-- Events -->
    <h4 class="m-b-20">
      <a data-toggle="modal" data-target="#addEvent" title="Add Event">
        <i class="fa fa-plus sameline subtle m-r-20"></i>
      </a>
      Events
      <a href="{% url 'story_event_list' pk=story.id %}" class="link-text m-b-40 subtle">
        <span class="f-s-12 f-w-400 subtle"> (All events <i class="fa fa-long-arrow-right subtle" aria-hidden="true">)</i></span>
      </a>
    </h4>
    {% with view.story_events as events %}
    <div class="row m-b-20">
      <div class="col-xs-12">
        {% for event in events.events|slice:":5" %}
        <p><i class="fa fa-calendar" aria-hidden="true"></i>  <a href="{% url 'event_detail' pk=event.id %}" title="See event details">{{ event.name }}</a>
          <br><span class="card-text color-default f-s-12"> {{ event.event_date|date:'N j, g:i a'}}</span></p>
        {% endfor %}
      </div>
    </div>
    {% endwith %}

  </div>
  <!-- End of Middle Column -->
  <!-- Right Column -->
  <div class="col-xs-12 col-md-4">
    <!-- Notes -->
    <div class="storynotes">
      {% with view.story_notes as notes %}
        <h4 class="m-b-20">
          <a data-toggle="modal" data-target="#addStoryNote" title="Add Story Note">
            <i class="fa fa-plus sameline subtle m-r-20"></i>
          </a>
          Notes
          <a href="{% url 'story_notes' pk=story.id %}" class="link-text m-b-40 subtle">
            <span class="f-s-12 f-w-400 subtle"> (All notes <i class="fa fa-long-arrow-right subtle" aria-hidden="true">)</i></span>
          </a>
        </h4>
        <div id="displaynotes" class="activity-widget-4">
          {% for note in notes.notes %}
            <div class="row">
                <div class="col-xs-12">
                  <div class="media">
                    <div class="media-body">
                      <h5 class="media-heading">
                        {% if note.important == True %}
                        <i class="fa fa-star f-r-8 color-warning-100" aria-hidden="true"></i>
                        {% else %}
                        <i class="fa fa-star-o f-r-8 subtle" aria-hidden="true"></i>
                        {% endif %}
                        <a data-toggle="modal" data-target="#viewNote{{note.id}}" title="View Story Note"> {{ note.title }} </a>
                      </h5>
                      <small class="color-default">{{ note.creation_date|date:'N j, g:i a' }}</small>
                      <!-- Note Delete -->
                      <form class="note-delete sameline" method="GET"
                            action="{% url 'note_delete' note.id %}">
                            {% csrf_token %}
                        <a href="javascript:$('.note-delete').submit();"><i class="fa fa-trash subtle float-right" style="float:right;" aria-hidden="true"></i></a>
                      </form>
                    </div>
                  </div>
                </div>
            </div>
          {% endfor %}
        </div>
      {% endwith %}
    </div>

  </div>
  <!-- End of Right Column -->

</div>
<!-- End of Row Two -->


<!-- ================================================= -->
                  <!-- JS SCRIPTS -->
<!-- ================================================= -->

<!-- Chosen, Thumbnails, Image Library -->
<script>
  $(".chosen-select").chosen()

  $('#story-thumbs').magnificPopup({
    delegate: 'a',
    type: 'image',
    gallery: {enabled:true}
  });

  $('.image-library').magnificPopup({
    delegate: 'a',
    type: 'image',
    gallery: {enabled:true}
  });

  $('#image-thumbs').magnificPopup({
    delegate: 'a',
    type: 'image',
    gallery: {enabled:true}
  });

</script>

<!-- Embedded Video -->
<script>
    $('.embedded-video').magnificPopup({
      type: 'iframe',
      iframe: {
          patterns: {
              youtube: {
                  index: 'youtu.be/',
                  id: function(url) {
                      var m = url.match(/[\\?\\&]v=([^\\?\\&]+)/);
                      if ( !m || !m[1] ) return null;
                      return m[1];
                  },
                  src: '//www.youtube.com/embed/%id%?autoplay=1'
              },
              vimeo: {
                  index: 'vimeo.com/',
                  id: function(url) {
                      var m = url.match(/(https?:\/\/)?(www.)?(player.)?vimeo.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/);
                      if ( !m || !m[5] ) return null;
                      return m[5];
                  },
                  src: '//player.vimeo.com/video/%id%?autoplay=1'
              }
          }
      }
    });

</script>

<!-- Story Schedule -->
<script>
    (function() {
        'use strict';

        $(function() {
            var events_array = $.get('{% url "story_schedule" story.id %}')
            $('#calendar').fullCalendar({
                dayClick: function(date, jsEvent, view) {
                    console.log('Clicked on: ' + date.format());
                    console.log('Event: ', jsEvent);
                    console.log('Coordinates: ' + jsEvent.pageX + ',' + jsEvent.pageY);
                    console.log('Current view: ' + view.name);
                    //$(this).css('background-color', 'red');
                },
                header: {
                    left: 'prev,next',
                    center: '',
                    right: 'title'
                },
                // defaultDate: '2016-03-12',
                defaultView: 'month',
                editable: true,
                events: '{% url "story_schedule" story.id %}',
                // events: [{
                //     title: 'Click for Google',
                //     url: 'http://google.com/',
                //     start: '2016-08-28'
                // }]
            });

        });


    })();
</script>

<!-- Story Delete Confirmation alerts -->
<script>
  $('.story-delete a').on('click', function(e) {
       e.preventDefault();
          swal({
              title: 'Are you sure?',
              text: 'You will not be able to recover this story.',
              type: 'warning',
              showCancelButton: true,
              confirmButtonColor: '#3085d6',
              cancelButtonColor: '#d33',
              confirmButtonText: 'Yes, delete it!',
              closeOnConfirm: true
          }, function(result) {
              if (result) {
                $(".story-delete").attr("method", "POST").submit();
              } else {
                // do nothing on cancel
            }
          });
        });
</script>

<!-- Note Delete -->
<script>
  $('.note-delete a').on('click', function(e) {
       e.preventDefault();
          swal({
              title: 'Are you sure?',
              text: 'You will not be able to recover this note.',
              type: 'warning',
              showCancelButton: true,
              confirmButtonColor: '#3085d6',
              cancelButtonColor: '#d33',
              confirmButtonText: 'Yes, delete it!',
              closeOnConfirm: true
          }, function(result) {
              if (result) {
                $(".note-delete").attr("method", "POST").submit();
              } else {
                // do nothing on cancel
            }
          });
        });
</script>

<!-- Timeout Messages -->
<script>
  $(document).ready(function() {
      // messages timeout for 10 sec
      setTimeout(function() {
          $('.message').fadeOut('slow');
      }, 5000); // <-- time in milliseconds, 1000 =  1 sec

      // delete message
      $('.del-msg').live('click',function(){
          $('.del-msg').parent().attr('style', 'display:none;');
      })
  });
</script>


{% endblock %}

<!-- ================================================= -->
<!-- ================================================= -->
                <!-- MODALS -->
<!-- ================================================= -->
<!-- ================================================= -->

{% block modals %}

<!-- ================================================= -->
          <!-- Add Story Task Modal -->
<!-- ================================================= -->

{% with view.story_tasks as task %}
<div class="modal fade" id="addStoryTask" tabindex="-1" role="dialog" aria-labelledby="addStoryTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h5 class="modal-title" id="addTaskModalLabel">Add a task for this story</h5>
            </div>
            <div class="modal-body">
              <form action="{% url 'task_new' %}" method="POST" class="post-form">
              {% csrf_token %}

              <div class="row">
                <div class="col-xs-12">
                      <!-- Name -->
                      <fieldset class="form-group m-b-10">
                        {% comment %}<label class="f-s-12 f-s-400 spread-01 subtle slim-margin">{{ task.form.name.label_tag }}</label>{% endcomment %}
                        {{ task.form.name }}
                        {% if task.form.name.errors %}
                          <small class="text-muted">{{ task.form.name.errors }}</small>
                        {% endif %}
                      </fieldset>
                      <!-- Details -->
                      <fieldset class="form-group m-b-10">
                        {% comment %}<label class="f-s-12 f-s-400 spread-01 subtle slim-margin">{{ task.form.text.label_tag }}</label>{% endcomment %}
                        {{ task.form.text }}
                        {% if task.form.text.errors %}
                          <small class="text-muted">{{ task.form.text.errors }}</small>
                        {% endif %}
                      </fieldset>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12 col-md-6">
                    <!-- Importance -->
                    <fieldset class="form-check m-b-10">
                      <label class="f-s-12 f-s-400 spread-01 subtle slim-margin">{{ task.form.important.label_tag }}</label>
                      {{ task.form.important }}
                      {% if task.form.important.errors %}
                        <small class="text-muted">{{ task.form.important.errors }}</small>
                      {% endif %}
                    </fieldset>
                    <!-- Due Date -->
                    <fieldset class="form-group m-b-10">
                      <label class="f-s-12 f-s-400 spread-01 subtle slim-margin">{{ task.form.due_date.label_tag }}</label>
                      {{ task.form.due_date }}
                      {% if task.form.due_date.errors %}
                        <small class="text-muted">{{ task.form.due_date.errors }}</small>
                      {% endif %}
                    </fieldset>
                </div>
                <div class="col-xs-12 col-md-6">
                    <!-- Assigned To -->
                    <fieldset class="form-group m-b-10">
                      {% comment %}<label class="f-s-12 f-s-400 spread-01 subtle slim-margin">{{ task.form.assigned_to.label_tag }}</label>{% endcomment %}
                      {{ task.form.assigned_to }}
                      {% if task.form.assigned_to.errors %}
                        <small class="text-muted">{{ task.form.assigned_to.errors }}</small>
                      {% endif %}
                    </fieldset>
                    <!-- Status -->
                    <fieldset class="form-group m-b-10">
                      <label class="f-s-12 f-s-400 spread-01 subtle slim-margin">{{ task.form.status.label_tag }}</label>
                      {{ task.form.status }}
                      {% if task.form.status.errors %}
                        <small class="text-muted">{{ task.form.status.errors }}</small>
                      {% endif %}
                    </fieldset>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12">
                  <input type="hidden" name="story" value="{{ story.pk }}" />
                  <button type="submit" class="btn btn-default">Add Story</button>
                </div>
              </div>

              </form>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
    <script>
    $(".chosen-select").chosen()
    </script>
</div>
{% endwith %}

<!-- ================================================= -->
          <!-- Add Story Note Asset Modal -->
<!-- ================================================= -->

{% with view.story_notes as notes %}
  <div class="modal fade" id="addStoryNote" tabindex="-1" role="dialog" aria-labelledby="addStoryNoteModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h5 class="modal-title" id="addStoryNoteModalLabel">Add a note for this story</h5>
      </div>
      <div class="modal-body">
        <form action="{% url 'create_storynote' %}" method="POST" class="post-form">
        {% csrf_token %}
        {% bootstrap_form notes.form %}
        <!-- Hidden Inputs -->
        <input type="hidden" name="association" value="story" />
        <input type="hidden" name="story" value="{{ story.pk }}" />
        <button type="submit" class="btn btn-default">Post Note</button>
        </form>
      </div>
      <div class="modal-footer">
      </div>
    </div>
  </div>
</div>

  {% for note in notes.notes %}

  <!-- ================================================= -->
          <!-- View Story Note Modal -->
  <!-- ================================================= -->

  <div class="modal fade" id="viewNote{{note.id}}" tabindex="-1" role="dialog" aria-labelledby="viewNote{{note.id}}">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="viewNote{{note.id}}Label">{{ note.title }}</h4>
        </div>
        <div class="modal-body">
          {{ note.text|linebreaksbr }}
        </div>
        <div class="modal-footer">
          <p class="tiny-text">{{ note.owner }} | {{ note.creation_date|date:'D M j g:i a' }}<p>
        </div>
      </div>
    </div>
  </div>
  <!-- END View Note Modals -->
  {% endfor %}
{% endwith %}

<!-- ================================================= -->
          <!-- Simple Image Asset Modal -->
<!-- ================================================= -->

{% with view.simple_images as images %}
<div class="modal fade" id="SimpleImageAssetModal" tabindex="-1" role="dialog" aria-labelledby="SimpleImageAssetModal">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="bs-nav-tabs nav-tabs-default">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <ul class="nav nav-tabs nav-animated-border-from-left">
            <li class="nav-item"> <a ng-href="" class="nav-link active" data-toggle="tab" data-target="#uploadimage">Upload a Photo</a></li>
          </ul>
        </div>
        <div class="modal-body" id="imagemodalbody">
          <div class="tab-content">
            <!-- UPLOAD PANEL -->
            <div role="tabpanel" class="tab-pane active" id="uploadimage">
              <div class="uploadpanel" data-toggle="slimScroll" style="height:300px" data-color="#5D9CEC" data-allow-page-scroll="false">
              <form action="{% url 'upload_simple_image' %}" method="POST" class="post-form" enctype="multipart/form-data">
              {% csrf_token %}
              <!-- Left Col -->
              <div class="col-md-6">

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ images.form.photo.label_tag }}</label>
                  {{ images.form.photo }}
                  {% if images.form.photo.errors %}
                    <small class="text-muted">{{ images.form.photo.errors }}</small>
                  {% endif %}
                </fieldset>

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin"><span class="field-label">{{ images.form.title.label_tag }}</label>
                  {{ images.form.title }}
                  {% if images.form.title.errors %}
                    <small class="text-muted">{{ images.form.title.errors }}</small>
                  {% endif %}
                </fieldset>

              </div>
              <!-- End Left Col -->
              <!-- Right Col -->
              <div class="col-md-6">

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ images.form.description.label_tag }}</label>
                  {{ images.form.description }}
                  {% if images.form.description.errors %}
                    <small class="text-muted">{{ images.form.description.errors }}</small>
                  {% endif %}
                </fieldset>


              </div>
              <!-- End Right Col -->
              <!-- ===================================== -->
              <!-- ===================================== -->
              <div class="hidden-image-inputs">
                  <input type="hidden" name="association" value="story" />
                  <input type="hidden" name="story" value="{{ story.pk }}" />
              </div>
              <!-- ===================================== -->
              <!-- ===================================== -->
              <div>
                <button type="submit" class="btn btn-primary m-l-20">Save Image</button>
              </div>
              </form>
              </div>
            </div>
            <!-- END UPLOAD PANEL -->
          </div>
        </div>
        </div>
        <div class="modal-footer"></div>
      </div>
    </div>
  </div>
{% endwith %}

<!-- ================================================= -->
          <!-- Simple Document Asset Modal -->
<!-- ================================================= -->

{% with view.simple_documents as documents %}
<div class="modal fade" id="SimpleDocumentAssetModal" tabindex="-1" role="dialog" aria-labelledby="SimpleDocumentAssetModal">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="bs-nav-tabs nav-tabs-default">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <ul class="nav nav-tabs nav-animated-border-from-left">
            <li class="nav-item"> <a ng-href="" class="nav-link active" data-toggle="tab" data-target="#uploaddocument">Upload a Document</a></li>
          </ul>
        </div>
        <div class="modal-body" id="documentmodalbody">
          <div class="tab-content">
            <!-- UPLOAD PANEL -->
            <div role="tabpanel" class="tab-pane active" id="uploaddocument">
              <div class="uploadpanel" data-toggle="slimScroll" style="height:300px" data-color="#5D9CEC" data-allow-page-scroll="false">
              <form action="{% url 'upload_simple_document' %}" method="POST" class="post-form" enctype="multipart/form-data">
              {% csrf_token %}
              <!-- Left Col -->
              <div class="col-md-6">

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.document.label_tag }}</label>
                  {{ documents.form.document }}
                  {% if documents.form.document.errors %}
                    <small class="text-muted">{{ documents.form.document.errors }}</small>
                  {% endif %}
                </fieldset>

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.title.label_tag }}</label>
                  {{ documents.form.title }}
                  {% if documents.form.title.errors %}
                    <small class="text-muted">{{ documents.form.title.errors }}</small>
                  {% endif %}
                </fieldset>

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.asset_type.label_tag }}</label>
                  {{ documents.form.asset_type }}
                  {% if documents.form.asset_type.errors %}
                    <small class="text-muted">{{ documents.form.asset_type.errors }}</small>
                  {% endif %}
                </fieldset>

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.keywords.label_tag }}</label>
                  {{ documents.form.keywords }}
                  {% if documents.form.keywords.errors %}
                    <small class="text-muted">{{ documents.form.keywords.errors }}</small>
                  {% endif %}
                </fieldset>

              </div>
              <!-- End Left Col -->
              <!-- Right Col -->
              <div class="col-md-6">

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.description.label_tag }}</label>
                  {{ documents.form.description }}
                  {% if documents.form.description.errors %}
                    <small class="text-muted">{{ documents.form.description.errors }}</small>
                  {% endif %}
                </fieldset>

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.attribution.label_tag }}</label>
                  {{ documents.form.attribution }}
                  {% if documents.form.attribution.errors %}
                    <small class="text-muted">{{ documents.form.attribution.errors }}</small>
                  {% endif %}
                </fieldset>

              </div>
              <!-- End Right Col -->
              <!-- ===================================== -->
              <!-- ===================================== -->
              <div class="hidden-document-inputs">
                <input type="hidden" name="association" value="story" />
                <input type="hidden" name="story" value="{{ story.pk }}" />
              </div>
              <!-- ===================================== -->
              <!-- ===================================== -->
              <div>
                <button type="submit" class="btn btn-primary m-l-20">Save Document</button>
              </div>
              </form>
              </div>
            </div>
            <!-- END UPLOAD PANEL -->
          </div>
        </div>
        </div>
        <div class="modal-footer"></div>
      </div>
    </div>
  </div>
</div>
{% endwith %}

<!-- ================================================= -->
              <!-- Add Event Modal -->
<!-- ================================================= -->

<div class="modal fade" id="addEvent" tabindex="-1" role="dialog" aria-labelledby="addEventLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h5 class="modal-title" id="addEventModalLabel">Add an event for this story</h5>
      </div>
      <div class="modal-body">
        <form action="{% url 'event_new' %}" method="POST" class="post-form">
        {% csrf_token %}
        {% comment %}
        {% bootstrap_form notes.form %}
        {% endcomment %}
        <!-- Hidden Inputs -->
        <input type="hidden" name="association" value="story" />
        <input type="hidden" name="story" value="{{ story.pk }}" />
        <button type="submit" class="btn btn-default">Post Note</button>
        </form>
      </div>
      <div class="modal-footer">
      </div>
    </div>
  </div>
</div>

<!-- ================================================= -->
                <!-- DOWNLOAD MODAL -->
<!-- ================================================= -->

{% include "editorial/storydownloadmodal.html" %}


{% endblock modals %}
