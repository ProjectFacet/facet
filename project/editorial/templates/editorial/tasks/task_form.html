{% extends 'base.html' %}

{% load i18n %}
{% load bootstrap3 %}

<!-------------------------------------------->
<!--      BREADCRUMB NAVIGATION             -->
<!-------------------------------------------->

{% block breadcrumb %}
<div>
    <ol class="breadcrumb icon-angle-right icon-th">
        <li class="fadeIn"><a href="{% url 'dashboard' %}" title="Go to Dashboard"> Dashboard </a></li>
        {% if task %}
          {% if task.project %}
          <li class="fadeIn"><a href="{% url 'project_list' %}" title="Go to Project List"> Projects </a></li>
          <li class="fadeIn"><a href="{% url 'project_detail' pk=task.project.id %}" title="Go to {{task.project.name}}"> {{task.project.name}} </a></li>
          <li class="fadeIn"><a href="{% url 'project_task_list' pk=task.project.id %}" title="Go to {{task.project.name}} Tasks"> Tasks </a></li>
          <li class="fadeIn"> {{ task.name }}</li>
          <li class="fadeIn"> Update</li>
          {% elif task.story %}
          <li class="fadeIn"><a href="{% url 'story_list' %}" title="Go to Story List"> Stories </a></li>
          <li class="fadeIn"><a href="{% url 'story_detail' pk=task.story.id %}" title="Go to {{task.story.name}}"> {{task.story.name}} </a></li>
          <li class="fadeIn"><a href="{% url 'story_task_list' pk=task.story.id %}" title="Go to {{task.story.name}} Tasks"> Tasks </a></li>
          <li class="fadeIn"> {{ task.name }}</li>
          <li class="fadeIn"> Update</li>
          {% elif task.event %}
          <li class="fadeIn"><a href="{% url 'event_list' %}" title="Go to Event List"> Events </a></li>
          <li class="fadeIn"><a href="{% url 'event_detail' pk=task.event.id %}" title="Go to {{task.event.name}}"> {{task.event.name}} </a></li>
          <li class="fadeIn"><a href="{% url 'event_task_list' pk=task.event.id %}" title="Go to {{task.event.name}} Tasks"> Tasks </a></li>
          <li class="fadeIn"> {{ task.name }}</li>
          <li class="fadeIn"> Update</li>
          {% endif %}

        {% else %}
        <li class="fadeIn"> New Task</li>
        {% endif %}
    </ol>
</div>
{% endblock breadcrumb %}

<!-------------------------------------------->
<!--            Main Section                -->
<!-------------------------------------------->

{% block content %}

<div class="row m-b-20">
  <div class="col-xs-12">
    <h5 class="m-b-20 sameline">
      {% if task.status == "Identified" %}
      <i class="fa fa-circle-o color-warning-300 fa-1x m-r-10" aria-hidden="true"></i>
      {% elif task.status == "In Progress" %}
      <i class="fa fa-circle-o-notch fa-spin color-primary-500 fa-1x m-r-10" aria-hidden="true"></i>
      {% elif task.status == "Complete" %}
      <i class="fa fa-check-circle-o color-success-300 fa-1x m-r-10" aria-hidden="true"></i>
      {% endif %}
      {{task.name}}
    </h5>
    {% if task %}
    <form class="task-delete sameline" method="GET"
          action="{% url 'task_delete' pk=task.id %}">
          <!-- onsubmit="return confirm('Do you want to delete this task?')"> -->
          {% csrf_token %}
      <a href="javascript:$('.task-delete').submit();"><i class="fa fa-trash subtle" aria-hidden="true"></i></a>
      <!-- <input type="submit" class="btn btn-sm btn-danger-100" value="Delete"> -->
    </form>
    {% endif %}
  </div>
</div>


<!-- The html for detail form is same regardless of associated object: Project, Story or Event -->
<div class="row">
  <form method="POST" class="post-form" enctype="multipart/form-data">{% csrf_token %}
    <div class="form-row">
      <!-- Left Columm -->
      <div class="form-group col-xs-12 col-sm-12 col-md-2 col-lg-2">
        <!-- Task name -->
        <div class="form-group">
          {% comment %}
            <label>{{ form.name.label_tag }}</label>
          {% endcomment %}
            {{ form.name }}
            {% if form.name.errors %}
            <small class="text-muted">{{ form.name.errors }}</small>
            {% endif %}
        </div>
        <!-- Due Date -->
        <label class="f-s-12 f-s-400 spread-01 subtle slim-margin">Due Date</label>
        <div class="form-group">
              {{ form.due_date }}
              {% if form.due_date.errors %}
                <small class="text-muted">{{ form.due_date.errors }}</small>
              {% endif %}
        </div>
        <!-- Team Selection -->
        <p><span class="m-t-20 m-b-20 m-r-10 f-s-14 f-s-400 spread-01 subtle slim-margin"> Team </span></p>
        {% for user in task.assigned_to.all %}
          {% if user.display_photo %}
            <a href="{% url 'user_detail' user.id %}" title="See user profile"><img class="img-circle w-40 h-40 m-b-10" src="{{ user.display_photo.url }}" alt="user"></a>
          {% endif %}
        {% endfor %}
        <div class="form-group">
          {% comment %}
            <label class="capitalize">{{ form.assigned_to.label_tag }}</label>
          {% endcomment %}
            {{ form.assigned_to }}
            {% if form.assigned_to.errors %}
              <small class="text-muted">{{ form.assigned_to.errors }}</small>
            {% endif %}
        </div>
        <!-- Important -->
        <div class="form-group">
          <div class="form-check">
            <label class="form-check-label">
              <input class="form-check-input" type="checkbox"> Important
            </label>
            {% if form.important.errors %}
              <small class="text-muted">{{ form.important.errors }}</small>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Center Column -->
      <div class="col-xs-12 col-sm-12 col-md-8 col-lg-8">
        <!-- Task Text -->
        <div class="form-group">
        {% comment %}
          <label>{{ form.text.label_tag }}</label>
        {% endcomment %}
        {{ form.text }}
        {% if form.text.errors %}
          <small class="text-muted">{{ form.text.errors }}</small>
        {% endif %}
        </div>
      </div>

      <!-- Right Column -->

      <!-- Save Button -->
      <div class="form-group col-xs-12 col-sm-12 col-md-2 col-lg-2">
      <div class="row">
        <div class="col-xs-12 m-b-40">
          {% if task.status == "Identified" %}
          <button type="submit" class="btn btn-warning content-bottom-10 btn btn-block no-border" name="form">Save Changes</button>
          {% elif task.status == "In Progress" %}
          <button type="submit" class="btn btn-primary content-bottom-10 btn btn-block no-border" name="form">Save Changes</button>
          {% elif task.status == "Complete" %}
          <button type="submit" class="btn btn-success content-bottom-10 btn btn-block no-border" name="form">Save Changes</button>
          {% else %}
          <button type="submit" class="btn btn-default content-bottom-10 btn btn-block no-border" name="form">Create Task</button>
          {% endif %}
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12">
          <!-- Status Select -->
          <div class="form-group" id="fieldset-task-projects">
            {{ form.status }}
            {% if form.status.errors %}
              <small class="text-muted">{{ form.status.errors }}</small>
            {% endif %}
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12 m-b-40">
          <p class="f-s-14 subtle">Associate the task with a Project, Story or Event</p>
          <!-- Project Select -->
          <div class="form-group" id="fieldset-task-projects">
            {% comment %}
              <label class="capitalize pull-left subtle f-s-14">{{ form.project.label_tag }}</label>
            {% endcomment %}
            {{ form.project }}
            {% if form.project.errors %}
              <small class="text-muted">{{ form.project.errors }}</small>
            {% endif %}
          </div>
          <!-- Story Select -->
          <div class="form-group" id="fieldset-task-stories">
            {% comment %}
              <label class="capitalize pull-left subtle f-s-14">{{ form.story.label_tag }}</label>
            {% endcomment %}
            {{ form.story }}
            {% if form.story.errors %}
              <small class="text-muted">{{ form.story.errors }}</small>
            {% endif %}
          </div>
          <!-- Event Select -->
          <div class="form-group" id="fieldset-task-events">
            {% comment %}
              <label class="capitalize pull-left subtle f-s-14">{{ form.event.label_tag }}</label>
            {% endcomment %}
            {{ form.event }}
            {% if form.event.errors %}
              <small class="text-muted">{{ form.event.errors }}</small>
            {% endif %}
          </div>
        </div>
      </div>


    </div>
    </div>
  </form>
</div>
<!-- End of form -->
{% if task %}
<div class="row m-t-20">
  <!-- Left Column -->
  <div class="col-xs-12 col-md-6 col-lg-4">
    <h5>Discussion</h5>
    {% with view.task_discussion as discussion %}
    <!-- Display Comments -->
    <div class="taskdiscussion">
        <div class="row">
          {% if discussion.comments %}
            {% for comment in discussion.comments %}
              <div class="col-md-10">
                <p class="f-s-12">{{ comment.text }} <span class="f-s-10 color-default">| {{ comment.date|date:'D, M j g:i a' }}</span></p>
              </div>
              <div class="col-md-2">
                {% if comment.user.display_photo %}
                <a href="" title="{{ comment.user.first_name }}"><img class="media-object img-circle neg-m-l-10" width="32" src="{{ comment.user.display_photo.url }}" alt="user"></a>
                {% else %}
                {% endif %}
              </div>
            {% endfor %}
          {% else %}
            <p class="f-r-8 subtle text-center italic m-b-40 m-t-40">This is where you will see comments <br> from the task discussion.</p>
            <p class="f-r-8 subtle text-center italic m-b-40 m-t-40">Add a comment below to <br>start the conversation.</p>
          {% endif %}

        </div>
    </div>
    <!-- Comment Form -->
    <div class="comment">
        <div class="row">
          <form action="{% url 'create_taskcomment' %}" method="POST" class="post-form" role="form">
            <div class="col-xs-12">
                {% csrf_token %}
                <div class="input-group">
                  {{ discussion.form.text }}

                  {% if discussion.form.text.errors %}
                    <div class="alert alert-warning" role="alert">
                    {{ discussion.form.text.errors }}
                    </div>
                  {% endif %}
                  <!-- Hidden Inputs -->
                  <input type="hidden" name="association" value="task" />
                  <input type="hidden" name="task" value="{{ task.pk }}" />
                  <span class="input-group-btn">
                    <button id="taskcommentbutton" class="btn btn-default btn-lg" type="submit" name="taskcommentform"><i class="fa fa-paper-plane"></i></button>
                  </span>
                </div>
            </div>
          </form>
        </div>
    </div>

    {% endwith %}
  </div>
  <!-- Middle Column -->
  <div class="col-xs-12 col-md-6 col-lg-4">
    {% with view.task_notes as notes %}
    <h5 class="m-b-20">
      <a data-toggle="modal" data-target="#addTaskNote" title="Add Task Note">
        <i class="fa fa-plus sameline subtle m-r-20"></i>
      </a>
      Notes
      <a href="{% url 'task_notes' task.id %}" class="link-text m-b-40 subtle">
        <span class="f-s-12 f-w-400 subtle"> (All notes <i class="fa fa-long-arrow-right subtle" aria-hidden="true">)</i></span>
      </a>
    </h5>
    <div class="activity-widget-4">
    {% for note in notes.notes %}
      <div class="row">
        <div class="col-xs-12">
          <div class="media">
            <div class="media-body">
              <h5 class="media-heading">
                {% if note.important == True %}
                <i class="fa fa-star f-r-8 color-warning-100" aria-hidden="true"></i>
                {% else %}
                <i class="fa fa-star-o f-r-8 subtle" aria-hidden="true"></i>
                {% endif %}
                <a data-toggle="modal" data-target="#viewNote{{note.id}}" title="View Event Note"> {{ note.title }} </a>
              </h5>
              <small class="f-s-14">{{ note.owner.credit_name }}</small></br>
              <small class="color-default">{{ note.creation_date|date:'N j, g:i a' }}</small>
              <!-- Note Delete -->
              <form class="note-delete sameline" method="GET"
                    action="{% url 'note_delete' note.id %}">
                    <!-- onsubmit="return confirm('Do you want to delete this task?')"> -->
                    {% csrf_token %}
                <a href="javascript:$('.note-delete').submit();"><i class="fa fa-trash subtle float-right" style="float:right;" aria-hidden="true"></i></a>
                <!-- <input type="submit" class="btn btn-sm btn-danger-100" value="Delete"> -->
              </form>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
    </div>
    {% endwith %}
  </div>
  <!-- Right Column -->
  <div class="col-xs-12 col-md-6 col-lg-4">
    <h5>Assets</h5>
    <div class="row">
    <!-- Images -->
    {% with view.simple_images as images %}
    <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
      <p class="f-r-12 f-w-300 m-b-20">Images <a href="#" data-toggle="modal" data-target="#SimpleImageAssetModal" title="Add Image"><i class="fa fa-plus sameline subtle"></i></a></p>
      <div id="image-thumbs">
        <div class="row m-b-10">
          {% for image in images.images %}
            {% if image.display_photo %}
              <div class="col-xs-6">
                <a href="{{ image.display_photo.url }}" class="thumbnail"><img src="{{ image.display_photo.url }}" alt="{{ image.description }}" class="img-fluid"></a>
                <!-- Opens modal to remove image -->
                <button type="button"
                        class="btn btn-sm clear-button f-r-6 subtle m-b-10"
                        title="Remove this image"
                        data-toggle="modal"
                        data-target="#removeImageModal"
                        data-imageid="{{ image.id }}"
                        data-imageurl="{{ image.display_photo.url }}"
                        data-actionurl="{% url 'simple_image_remove' simpleimage=image.id %}">
                        Remove
                </button>
              </div>
              {% if forloop.counter|divisibleby:"3" and not forloop.last %}
                </div><div class="row m-b-10">
              {% endif %}
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
    {% endwith %}
    <!-- Documents -->
    {% with view.simple_documents as documents %}
    <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
      <p class="f-r-12 f-w-300 m-b-20">Documents <a href="#" data-toggle="modal" data-target="#SimpleDocumentAssetModal" title="Add Document"><i class="fa fa-plus sameline subtle"></i></a></p>
      {% for document in documents.documents %}
        <a href="{{ document.document.url }}" target="_blank"><p class="f-w-300 m-l-10 f-r-9"><i class="fa fa-file subtle m-r-5"></i> {{ document.title }}</p></a>
        <!-- Opens modal to remove document -->
        <button type="button"
                class="btn btn-sm clear-button f-r-6 subtle m-b-10"
                title="Remove this document"
                data-toggle="modal"
                data-target="#removeDocumentModal"
                data-detailurl="{% url 'simple_document_detail' document.id %}"
                data-actionurl="{% url 'simple_document_remove' simpledocument=document.id %}"
                data-doctitle="{{ document.title }}">
                Remove
        </button>
        {% if forloop.counter|divisibleby:"2" and not forloop.last %}
        {% endif %}
      {% endfor %}
    </div>
    {% endwith %}
    </div>
  </div>
</div>
{% endif %}

<!-- ================================================= -->
<!-- ================================================= -->
                  <!-- JS SCRIPTS -->
<!-- ================================================= -->
<!-- ================================================= -->

<!-- Chosen, Image view -->
<script>
  $(".chosen-select").chosen()

  $('.image-library').magnificPopup({
    delegate: 'a',
    type: 'image',
    gallery: {enabled:true}
  });

  $('#image-thumbs').magnificPopup({
    delegate: 'a',
    type: 'image',
    gallery: {enabled:true}
  });

</script>

<!-- Task Delete -->
<script>
  $('.task-delete a').on('click', function(e) {
       e.preventDefault();
          swal({
              title: 'Are you sure?',
              text: 'You will not be able to recover this task.',
              type: 'warning',
              showCancelButton: true,
              confirmButtonColor: '#3085d6',
              cancelButtonColor: '#d33',
              confirmButtonText: 'Yes, delete it!',
              closeOnConfirm: true
          }, function(result) {
              if (result) {
                $(".task-delete").attr("method", "POST").submit();
              } else {
                // do nothing on cancel
            }
          });
        });
</script>

<!-- Note Delete Confirmation -->
<script>
  var form;
  $('.note-delete a').on('click', function(e) {
      form = e.currentTarget.closest("form");
      e.preventDefault();
        swal({
            title: 'Are you sure?',
            text: 'You will not be able to recover this note.',
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!',
            closeOnConfirm: true
        }, function(result) {
            if (result) {
              form.method = "POST";
              form.submit();
            } else {
              // do nothing on cancel
          }
        });
      });
</script>

<!-- Simple Asset Removal -->
<script>

  // Remove Asset Modals
  $(document).ready(function () {

    // Remove Image Modal
    $('#removeImageModal').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget) // Button that triggered the modal
      var imageURL = button.data('imageurl') // Extract info from data-* attributes
      var action = button.data('actionurl')
      var modal = $(this)
      modal.find('#img_src').attr('src', imageURL);
      modal.find('#removeform').attr('action', action);
    });

    // Remove Document Modal
    $('#removeDocumentModal').on('show.bs.modal', function (event) {
      // Button that triggered the modal
      var button = $(event.relatedTarget)
      // Extract info from data-* attributes
      var detailURL = button.data('detailurl')
      var documentTitle = button.data('doctitle')
      // var documentType = button.data('doctype')
      var documentType = 'other'
      // documentType = documentType.replace(/\s+/g, '');
      var action = button.data('actionurl')
      var modal = $(this)
      // Replace modal attributes
      modal.find('#'+ documentType).show();
      modal.find('#'+ documentType).attr('href', detailURL);
      modal.find('#removeform').attr('action', action);
      modal.find('p#title').html(documentTitle);
      // When modal is closed change style back to hidden to prevent multiple previews in modal
      $('#removeDocumentModal').on('hidden.bs.modal', function () {
        modal.find('#'+ documentType).attr('style', 'display:none');
      });

    });

    // Remove Audio Modal
    $('#removeAudioModal').on('show.bs.modal', function (event) {
      // Button that triggered the modal
      var button = $(event.relatedTarget)
      // Extract info from data-* attributes
      var audioID = button.data('audioid')
      console.log(audioID);
      var audioTitle = button.data('audiotitle')
      console.log(audioTitle);
      var audioURL = button.data('audiourl')
      console.log(audioURL);
      var audioType = button.data('audiotype')
      console.log(audioType);
      var action = button.data('actionurl')
      console.log(action);
      var modal = $(this)
      // Replace modal attributes
      // modal.find('#'+ audioType +"'").attr('style', "visibile")
      modal.find('#jplayer_audio').attr('title', audioTitle)
      modal.find('#jplayer_audio').attr('wav', audioURL);
      modal.find('#jplayer_audio').attr('mp3', audioURL);
      modal.find('#removeform').attr('action', action);
      modal.find('h4#display-audio-title').html(audioTitle);
    });

    // Remove Video Modal
    $('#removeVideoModal').on('show.bs.modal', function (event) {
      // Button that triggered the modal
      var button = $(event.relatedTarget)
      // Extract info from data-* attributes
      var videoID = button.data('videoid')
      console.log(videoID);
      var videoTitle = button.data('videotitle')
      console.log(videoTitle);
      var videoType = button.data('videotype')
      console.log(videoType);
      var action = button.data('actionurl')
      console.log(action);
      var modal = $(this)
      // Replace modal attributes
      // modal.find('#'+ videoType +"'").attr('style', "visibile")
      modal.find('#removeform').attr('action', action);
      modal.find('h4#display-video-title').html(videoTitle);
    });

  });

</script>


{% endblock %}

<!-- ================================================= -->
<!-- ================================================= -->
                <!-- MODALS -->
<!-- ================================================= -->
<!-- ================================================= -->


{% block modals %}


<!-- ================================================= -->
          <!-- Simple Image Remove Asset Modal -->
<!-- ================================================= -->


<!-- Remove Simple Image Modal -->
<div class="modal" id="removeImageModal" tabindex="-1" role="dialog" aria-labelledby="removeImageModal" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title sameline" id="removeImageLabel">Remove Image</h5>
        <button type="button" class="close sameline" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <img id="img_src" src="{{ simpleimage.display_photo.url }}" alt="{{ simpleimage.description }}" class="img-fluid"></a>
        <form id="removeform" action="#" method="POST" class="post-form">
        {% csrf_token %}
        <input type="hidden" name="association" value="task" />
        <input type="hidden" name="association_id" value="{{ task.pk }}" />
        <button type="submit" class="btn btn-primary btn-sm f-r-8 m-t-20" title="Remove this image">Remove</button>
      </form>
      </div>
    </div>
  </div>
</div>

<!-- Remove Simple Document Modal -->
<div class="modal" id="removeDocumentModal" tabindex="-1" role="dialog" aria-labelledby="removeDocumentModal" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title sameline" id="removeDocumentLabel">Remove Document</h5>
        <button type="button" class="close sameline" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Display Asset Here -->
        <div id="simpledocument-asset-library">
          <!-- PDF -->
          <a id="pdf" href="#" target="_blank" style="display: none;">
            <div class="card bs-card">
              <div class="card-block bg-danger-500">
                <p class="f-r-14 f-w-300 text-center m-t-10"> <i class="fa fa-file-pdf-o fa-1x text-center m-b-10"></i> .pdf </p>
              </div>
              <div class="card-block">
                <p id="title" class="f-r-10 f-w-500"></p>
              </div>
            </div>
          </a>
          <!-- WORD DOC -->
          <a id="doc" href="#" target="_blank" style="display: none;">
            <div class="card bs-card">
              <div class="card-block bg-info-500">
                <p class="f-r-14 f-w-300 text-center m-t-10"> <i class="fa fa-file-word-o fa-1x text-center m-b-10"> </i> .docx </p>
              </div>
              <div class="card-block">
                <p id="title" class="f-r-10 f-w-500"></p>
              </div>
            </div>
          </a>
          <!-- TEXT -->
          <a id="txt" href="#" target="_blank" style="display: none;">
            <div class="card bs-card">
              <div class="card-block bg-primary-500">
                <p class="f-r-14 f-w-300 text-center m-t-10"> <i class="fa fa-file-text-o fa-1x text-center m-b-10"> </i> .txt </p>
              </div>
              <div class="card-block">
                <p id="title" class="f-r-10 f-w-500"></p>
              </div>
            </div>
          </a>
          <!-- COMMA SEPARATED -->
          <a id="csv" href="#" target="_blank" style="display: none;">
            <div class="card bs-card">
              <div class="card-block bg-success-500">
                <p class="f-r-14 f-w-300 text-center m-t-10"> <i class="fa fa-file-excel-o fa-1x text-center m-b-10"> </i> .csv </p>
              </div>
              <div class="card-block">
                <p id="title" class="f-r-10 f-w-500"></p>
              </div>
            </div>
          </a>
          <!-- EXCEL -->
          <a id="xls" href="#" target="_blank" style="display: none;">
            <div class="card bs-card">
              <div class="card-block bg-success-500">
                <p class="f-r-14 f-w-300 text-center m-t-10"> <i class="fa fa-file-excel-o fa-1x text-center m-b-10"> </i> .xls </p>
              </div>
              <div class="card-block">
                <p id="title" class="f-r-10 f-w-500"></p>
              </div>
            </div>
          </a>
          <!-- OTHER -->
          <a id="other" href="#" target="_blank" style="display: none;">
            <div class="card bs-card">
              <div class="card-block bg-warning-500">
                <p class="f-r-14 f-w-300 text-center m-t-10"> <i class="fa fa-file-o fa-1x text-center m-b-10"> </i></p>
              </div>
              <div class="card-block">
                <p id="title" class="f-r-10 f-w-500"></p>
              </div>
            </div>
          </a>
        </div>
        <form id="removeform" action="#" method="POST" class="post-form">
        {% csrf_token %}
        <input type="hidden" name="association" value="task" />
        <input type="hidden" name="association_id" value="{{ task.pk }}" />
        <button type="submit" class="remove-document-link-{{simpledocument.id}} btn btn-primary btn-sm f-r-8 m-t-20" title="Remove this document">Remove</button>
      </form>
      </div>
    </div>
  </div>
</div>

<!-- Remove Simple Audio Modal -->
<div class="modal fade" id="removeAudioModal" tabindex="-1" role="dialog" aria-labelledby="removeAudioModal" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title sameline" id="removeAudioLabel">Remove Audio</h5>
        <button type="button" class="close sameline" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Display asset -->
        {% comment %}
        <div id="jplayer_audio" class="jp-jplayer"></div>
        <div id="jp_container_audio" class="jp-flat-audio m-t-10" role="application" aria-label="media player">
          <div class="jp-play-control jp-control">
            <button class="jp-play jp-button" role="button" aria-label="play" tabindex="0"></button>
          </div>
          <div class="jp-bar">
            <div class="jp-seek-bar jp-seek-bar-display"></div>
            <div class="jp-seek-bar">
              <div class="jp-play-bar"></div>
              <div class="jp-details"><span class="jp-title" aria-label="title"></span></div>
              <div class="jp-timing"><span class="jp-duration" role="timer" aria-label="duration"></span></div>
            </div>
          </div>
          <div class="jp-no-solution">
            Media Player Error<br />
            Update your browser or Flash plugin
          </div>
        </div>
        <script>
            jQuery(document).ready(function($) {
            $("#jplayer_audio").jPlayer({
              ready: function(event) {
                $(this).jPlayer("setMedia", {
                  title: "",
                  wav: "",
                  mp3: "",
                });
              },
              play: function() { // Avoid multiple jPlayers playing together.
                $(this).jPlayer("pauseOthers");
              },
              timeFormat: {
                padMin: false
              },
              swfPath: "js",
              supplied: "wav, mp3",
              cssSelectorAncestor: "#jp_container_audio",
              useStateClassSkin: true,
              autoBlur: false,
              smoothPlayBar: true,
              remainingDuration: true,
              keyEnabled: true,
              keyBindings: {
                // Disable some of the default key controls
                loop: null,
                muted: null,
                volumeUp: null,
                volumeDown: null
              },
              wmode: "window"
            });
            });
        </script>
        {% endcomment %}
        <h4 id="display-audio-title"></h4>
        <form id="removeform" action="#" method="POST" class="post-form">
        {% csrf_token %}
        <input type="hidden" name="association" value="task" />
        <input type="hidden" name="association_id" value="{{ task.pk }}" />
        <button type="submit" class="btn btn-primary btn-sm f-r-8 m-t-20" title="Remove this audio">Remove</button>
      </form>
      </div>
    </div>
  </div>
</div>

<!-- Remove Video Modal -->
<div class="modal fade" id="removeVideoModal" tabindex="-1" role="dialog" aria-labelledby="removeVideoModal" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title sameline" id="removeVideoLabel">Remove Video</h5>
        <button type="button" class="close sameline" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Display asset -->
        <h4 id="display-video-title"></h4>
        <form id="removeform" action="#" method="POST" class="post-form">
        {% csrf_token %}
        <input type="hidden" name="association" value="task" />
        <input type="hidden" name="association_id" value="{{ task.pk }}" />
        <button type="submit" class="btn btn-primary btn-sm f-r-8 m-t-20" title="Remove this video">Remove</button>
      </form>
      </div>
    </div>
  </div>
</div>















<!-- ================================================= -->
              <!-- EVENTNOTE MODALS -->
<!-- ================================================= -->

{% if task %}

<!-- Add Note Modal -->
{% with view.task_notes as notes %}
  <div class="modal fade" id="addTaskNote" tabindex="-1" role="dialog" aria-labelledby="addTaskNoteModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h5 class="modal-title" id="addTaskNoteLabel">Add a note for this task:</h5>
        </div>
        <div class="modal-body">
          <form action="{% url 'create_tasknote' %}" method="POST" class="post-form">
          {% csrf_token %}
          {% bootstrap_form notes.form %}
          <!-- Hidden Inputs -->
          <input type="hidden" name="association" value="task" />
          <input type="hidden" name="task" value="{{ task.pk }}" />
          <button type="submit" class="btn btn-primary m-t-20">Post Note</button>
          </form>
        </div>
        <div class="modal-footer">
        </div>
      </div>
    </div>
  </div>

  {% for note in notes.notes %}
    <!-- View Note Modals -->
    <div class="modal fade" id="viewNote{{note.id}}" tabindex="-1" role="dialog" aria-labelledby="viewNote{{note.id}}">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="viewNote{{note.id}}Label">{{ note.title }}</h4>
          </div>
          <div class="modal-body">
            {{ note.text|linebreaksbr }}
          </div>
          <div class="modal-footer">
            <p class="sameline tiny-text f-w-400 f-r-8" style="float:left;">{{ note.owner }} | {{ note.creation_date|date:'D M j g:i a' }}</p>
            <a href="{% url 'note_edit' note.id %}" title="Edit Note"><p class="tiny-text sameline float-right color-default f-r-8">Edit Note<p></a>
          </div>
        </div>
      </div>
    </div>
    <!-- END View Note Modals -->
  {% endfor %}

{% endwith %}

<!-- ================================================= -->
          <!-- Simple Image Asset Modal -->
<!-- ================================================= -->

{% with view.simple_images as images %}
<div class="modal fade" id="SimpleImageAssetModal" tabindex="-1" role="dialog" aria-labelledby="SimpleImageAssetModal">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="bs-nav-tabs nav-tabs-default">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <ul class="nav nav-tabs nav-animated-border-from-left">
            <li class="nav-item"> <a ng-href="" class="nav-link active" data-toggle="tab" data-target="#uploadimage">Upload a Photo</a></li>
            <li class="nav-item"> <a ng-href="" class="nav-link" data-toggle="tab" data-target="#addsimpleimage">Add a Photo</a></li>
          </ul>
        </div>
        <div class="modal-body" id="imagemodalbody">
          <div class="tab-content">
            <!-- UPLOAD PANEL -->
            <div role="tabpanel" class="tab-pane active" id="uploadimage">
              <div class="uploadpanel" data-toggle="slimScroll" style="height:300px" data-color="#5D9CEC" data-allow-page-scroll="false">
              <form action="{% url 'upload_simple_image' %}" method="POST" class="post-form" enctype="multipart/form-data">
              {% csrf_token %}
              <!-- Left Col -->
              <div class="col-md-6">

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ images.form.photo.label_tag }}</label>
                  {{ images.form.photo }}
                  {% if images.form.photo.errors %}
                    <small class="text-muted">{{ images.form.photo.errors }}</small>
                  {% endif %}
                </fieldset>

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin"><span class="field-label">{{ images.form.title.label_tag }}</label>
                  {{ images.form.title }}
                  {% if images.form.title.errors %}
                    <small class="text-muted">{{ images.form.title.errors }}</small>
                  {% endif %}
                </fieldset>

              </div>
              <!-- End Left Col -->
              <!-- Right Col -->
              <div class="col-md-6">

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ images.form.description.label_tag }}</label>
                  {{ images.form.description }}
                  {% if images.form.description.errors %}
                    <small class="text-muted">{{ images.form.description.errors }}</small>
                  {% endif %}
                </fieldset>


              </div>
              <!-- End Right Col -->
              <!-- ===================================== -->
              <!-- ===================================== -->
              <div class="hidden-image-inputs">
                  <input type="hidden" name="association" value="task" />
                  <input type="hidden" name="task" value="{{ task.pk }}" />
              </div>
              <!-- ===================================== -->
              <!-- ===================================== -->
              <div>
                <button type="submit" class="btn btn-primary m-l-20">Save Image</button>
              </div>
              </form>
              </div>
            </div>
            <!-- END UPLOAD PANEL -->
            <!-- ADD PANEL -->
            <div role="tabpanel" class="tab-pane" id="addsimpleimage">
              <div class="simpleimagelibrary" id="scrollthis" data-toggle="slimScroll" style="height:300px, overflow: scroll !important;" data-color="#5D9CEC" data-allow-page-scroll="false">
                <form action="{% url 'library_simpleimage_add' %}" method="POST" class="post-form" name="addimage">
                  {% csrf_token %}

                  <div class=" row image-library">
                  {% for image in images.addform.fields.simpleimages.queryset %}
                    <div class="col-md-2">
                      <label>
                        {% if image.display_photo %}<img class="img-responsive img-thumbnail" src="{{ image.display_photo.url }}" alt="{{ image.title }}">{% endif %}
                        {% if image in images.images %}
                        <i class="fa fa-check-square subtle" aria-hidden="true"></i>
                        {% else %}
                        <input type="checkbox" name="simpleimages" value="{{ image.id }}">
                        {% endif %}
                      </label>
                    </div>
                    {% if forloop.counter|divisibleby:"6" and not forloop.last %}
                      </div><div class="row">
                    {% endif %}
                  {% endfor %}
                  </div>

                <!-- ===================================== -->
                <!-- ===================================== -->
                <div class="hidden-image-inputs">
                  <input id="assoc" type="hidden" name="association" value="task" />
                  <input id="assoc_id" type="hidden" name="association_id" value="{{ task.id }}" />
                </div>
                <!-- ===================================== -->
                <!-- ===================================== -->

                  <div class="row">
                    <div class="col-xs-12">
                      <button type="submit" class="btn btn-primary" name="addimage">Add Images</button>
                    </div>
                  </div>
                </form>
              </div>

            </div>
            <!-- END ADD PANEL -->
          </div>
        </div>
        </div>
        <div class="modal-footer"></div>
      </div>
    </div>
  </div>
{% endwith %}

<!-- ================================================= -->
          <!-- Simple Document Asset Modal -->
<!-- ================================================= -->

{% with view.simple_documents as documents %}
<div class="modal fade" id="SimpleDocumentAssetModal" tabindex="-1" role="dialog" aria-labelledby="SimpleDocumentAssetModal">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="bs-nav-tabs nav-tabs-default">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <ul class="nav nav-tabs nav-animated-border-from-left">
            <li class="nav-item"> <a ng-href="" class="nav-link active" data-toggle="tab" data-target="#uploaddocument">Upload a Document</a></li>
            <li class="nav-item"> <a ng-href="" class="nav-link" data-toggle="tab" data-target="#addsimpledocument">Add a Document</a></li>
          </ul>
        </div>
        <div class="modal-body" id="documentmodalbody">
          <div class="tab-content">
            <!-- UPLOAD PANEL -->
            <div role="tabpanel" class="tab-pane active" id="uploaddocument">
              <div class="uploadpanel" data-toggle="slimScroll" style="height:300px" data-color="#5D9CEC" data-allow-page-scroll="false">
              <form action="{% url 'upload_simple_document' %}" method="POST" class="post-form" enctype="multipart/form-data">
              {% csrf_token %}
              <!-- Left Col -->
              <div class="col-md-6">

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.document.label_tag }}</label>
                  {{ documents.form.document }}
                  {% if documents.form.document.errors %}
                    <small class="text-muted">{{ documents.form.document.errors }}</small>
                  {% endif %}
                </fieldset>

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.title.label_tag }}</label>
                  {{ documents.form.title }}
                  {% if documents.form.title.errors %}
                    <small class="text-muted">{{ documents.form.title.errors }}</small>
                  {% endif %}
                </fieldset>

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.asset_type.label_tag }}</label>
                  {{ documents.form.asset_type }}
                  {% if documents.form.asset_type.errors %}
                    <small class="text-muted">{{ documents.form.asset_type.errors }}</small>
                  {% endif %}
                </fieldset>

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.keywords.label_tag }}</label>
                  {{ documents.form.keywords }}
                  {% if documents.form.keywords.errors %}
                    <small class="text-muted">{{ documents.form.keywords.errors }}</small>
                  {% endif %}
                </fieldset>

              </div>
              <!-- End Left Col -->
              <!-- Right Col -->
              <div class="col-md-6">

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.description.label_tag }}</label>
                  {{ documents.form.description }}
                  {% if documents.form.description.errors %}
                    <small class="text-muted">{{ documents.form.description.errors }}</small>
                  {% endif %}
                </fieldset>

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.attribution.label_tag }}</label>
                  {{ documents.form.attribution }}
                  {% if documents.form.attribution.errors %}
                    <small class="text-muted">{{ documents.form.attribution.errors }}</small>
                  {% endif %}
                </fieldset>

              </div>
              <!-- End Right Col -->
              <!-- ===================================== -->
              <!-- ===================================== -->
              <div class="hidden-document-inputs">
                <input type="hidden" name="association" value="task" />
                <input type="hidden" name="task" value="{{ task.pk }}" />
              </div>
              <!-- ===================================== -->
              <!-- ===================================== -->
              <div>
                <button type="submit" class="btn btn-primary m-l-20">Save Document</button>
              </div>
              </form>
              </div>
            </div>
            <!-- END UPLOAD PANEL -->
            <!-- ADD PANEL -->
            <div role="tabpanel" class="tab-pane" id="addsimpledocument">
              <div class="simpledocumentlibrary" id="scrollthis" data-toggle="slimScroll" style="height:300px, overflow: scroll !important;" data-color="#5D9CEC" data-allow-page-scroll="false">
                <form action="{% url 'library_simpledocument_add' %}" method="POST" class="post-form" name="adddocument">
                  {% csrf_token %}

                  <div class=" row document-library">
                  {% for document in documents.addform.fields.simpledocuments.queryset %}
                    <div class="col-md-2">
                      <label>
                        <a href="{% url 'simple_document_detail' pk=document.id %}">
                          <div class="card bs-card">
                            <div class="card-block bg-warning-500 p-10">
                              <p class="f-r-10 f-w-300 text-center m-b-0"> <i class="fa fa-file-o text-center"></i></p>
                            </div>
                            <div class="card-block  m-h-100 p-10">
                              <p class="f-r-8 f-w-400"> {{ document.title }} </p>
                            </div>
                          </div>
                        </a>
                        {% if document in documents.documents %}
                        <i class="fa fa-check-square subtle" aria-hidden="true"></i>
                        {% else %}
                        <input type="checkbox" name="simpledocuments" value="{{ document.id }}">
                        {% endif %}
                      </label>
                    </div>
                    {% if forloop.counter|divisibleby:"6" and not forloop.last %}
                      </div><div class="row">
                    {% endif %}
                  {% endfor %}
                  </div>

                <!-- ===================================== -->
                <!-- ===================================== -->
                <div class="hidden-document-inputs">
                  <input id="assoc" type="hidden" name="association" value="task" />
                  <input id="assoc_id" type="hidden" name="association_id" value="{{ task.id }}" />
                </div>
                <!-- ===================================== -->
                <!-- ===================================== -->

                  <div class="row">
                    <div class="col-xs-12">
                      <button type="submit" class="btn btn-primary" name="adddocument">Add Documents</button>
                    </div>
                  </div>
                </form>
              </div>

            </div>
            <!-- END ADD PANEL -->
          </div>
        </div>
        </div>
        <div class="modal-footer"></div>
      </div>
    </div>
  </div>
</div>
{% endwith %}

{% endif %}

{% endblock modals %}
