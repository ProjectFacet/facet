{% extends 'base.html' %}

{% load i18n %}
{% load bootstrap3 %}

<!-------------------------------------------->
<!--      BREADCRUMB NAVIGATION             -->
<!-------------------------------------------->

{% block breadcrumb %}
<div>
    <ol class="breadcrumb icon-angle-right icon-th">
      <li class="fadeIn"><a href="{% url 'dashboard' %}" title="Go to Dashboard"> Dashboard </a></li>
      <li class="fadeIn"><a href="{% url 'network_list' %}" title="Network List"> Networks </a></li>
      <li class="fadeIn"><a href="{% url 'network_stories' %}" title="You are here"> Network Content </a></li>
    </ol>
</div>
{% endblock breadcrumb %}

<!-------------------------------------------->
<!--            Main Section                -->
<!-------------------------------------------->

{% block content %}

<div class="row m-b-40">
  <div class="col-xs-12">
    {% if networkstories %}
    <!-- Full table for md and lg displays -->
    <table id="network-stories-list" class="table table-condensed table-striped hidden-sm-down">
      <thead>
        <tr>
          <th>Story</th>
          <th>Title</th>
          <th>Credit</th>
          <th>Organization</th>
          <th>Available</th>
        </tr>
      </thead>
      <tbody>
      {% for story in networkstories %}

        {% if story.facet_set.all %}
          {% for facet in story.facet_set.all %}
            {% if facet.story.ready_to_share %}
            <tr>
              <td>{{ facet.story.name }}<form action="{% url 'copy_network_story' story=story.id %}" method="POST" class="sameline">{% csrf_token %}<button class="clear clear-button" type="submit"><i class="fa fa-clone"></i></button></form></td>
              <td><a href="#" data-toggle="tooltip" title="{{ facet.description }}">{{ facet.headline }}</a> {% if story.ready_to_share %}<button type="button" class="clear clear-button m-l-10 subtle" data-toggle="modal" data-target="#previewModal" data-modaltitle="{{ facet.headline }}" data-modalcontent="{{ facet.content }}"><i class="fa fa-eye"></i></button>{% endif %}</td>
              <td>{% for user in facet.credit.all %}{{ user.credit_name }}, {% endfor %}</td>
              <td>{{ facet.organization.name }}</td>
              <td>{{ facet.story.share_with_date|date:'n/j, g:i a'}}</td>
            </tr>
            {% else %}
            <tr>
              <td>{{ facet.story.name }}</td>
              <td><a href="#" data-toggle="tooltip" title="{{ facet.description }}">{{ facet.headline }}</a> {% if story.ready_to_share %}<button type="button" class="clear clear-button m-l-10 subtle" data-toggle="modal" data-target="#previewModal" data-modaltitle="{{ facet.headline }}" data-modalcontent="{{ facet.content }}"><i class="fa fa-eye"></i></button>{% endif %}</td>
              <td>{{ facet.owner.credit_name }}</td>
              <td>{{ facet.organization.name }}</td>
              <td>{{ facet.story.share_with_date|date:'n/j, g:i a'}}</td>
            </tr>
            {% endif %}
          {% endfor %}
        {% else %}
            <tr>
              <td>{{ story.name }}{% if story.ready_to_share %}<form action="{% url 'copy_network_story' story=story.id %}" method="POST" class="sameline">{% csrf_token %}<button class="clear clear-button" type="submit"><i class="fa fa-clone"></i></button></form>{% endif %}</td>
              <td><i class="tiny-text">No Facets Currently</i></td>
              <td>{{ story.owner.credit_name }}</td>
              <td>{{ story.organization.name }}</td>
              <td>{{ story.share_with_date|date:'n/j, g:i a'}}</td>
            </tr>
        {% endif %}

      {% endfor %}
      </tbody>
    </table>
    <!-- End full table -->

    <!-- Partial table for xs and sm displays -->
    <table class="table table-condensed table-striped hidden-md-up">
      <thead>
        <tr>
          <th>Story</th>
          <th>Facets</th>
          <th>Organization</th>
          <th>Available</th>
        </tr>
      </thead>
      <tbody>
        {% for story in networkstories %}

          {% if story.facet_set.all %}
          <tr>
            <td>{{ story.name }}<form action="{% url 'copy_network_story' story=story.id %}" method="POST" class="sameline">{% csrf_token %}<button class="clear" type="submit"><i class="fa fa-clone"></i></button></form></td>
            <td>
              {% if story.facet_set.all %}{{ story.facet_set.all.count }}{% endif %}
            </td>
            <td>{{ story.organization.name }}</td>
            <td>{{ story.share_with_date|date:'n/j, g:i a'}}</td>
          </tr>
          {% else %}
              <tr>
                <td>{{ story.name }}</td>
                <td></td>
                <td>{{ story.organization.name }}</td>
                <td>{{ story.share_with_date|date:'n/j, g:i a'}}</td>
              </tr>
          {% endif %}

        {% endfor %}
      </tbody>
    </table>
    <!-- End partial table -->
    {% else %}
      <p class="f-s-18 subtle text-center italic m-b-40 m-t-40">Welcome to the Network Stories page. This is where you will see all of the current shared stories from your network partners.</p>
    {% endif %}
  </div>
</div>


<!-- ================================================= -->
                  <!-- JS SCRIPTS -->
<!-- ================================================= -->

<!-- Story Table JS -->
<script>
  $(document).ready(function() {
      $('#network-stories-list').DataTable();
  } );
</script>

{% endblock %}

<!-- ================================================= -->
                  <!-- MODALS -->
<!-- ================================================= -->

{% block modals %}

{% include "editorial/_networkstorypreview.html" %}

{% endblock modals %}
