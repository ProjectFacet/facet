{% extends 'base.html' %}

{% load i18n %}
{% load bootstrap3 %}

<!-------------------------------------------->
<!--      BREADCRUMB NAVIGATION             -->
<!-------------------------------------------->

{% block breadcrumb %}
<div>
    <ol class="breadcrumb icon-angle-right icon-th">
        <li class="fadeIn"><a href="{% url 'dashboard' %}" title="Go to Dashboard"> Dashboard </a></li>
        <li class="fadeIn"><a href="{% url 'series_list' %}" title="View Series"> Series </a></li>
        <li class="fadeIn"><a href="{% url 'series_detail' series.id %}" title="You are Here"> {{ series.name }} </a></li>
    </ol>
</div>
{% endblock breadcrumb %}

<!-- ====================================== -->
<!--            Main Section                -->
<!-- ====================================== -->

{% block content %}

<div class="row m-b-40">

  <!-- Left Col -->
  <div class="col-xs-12 col-md-4 col-lg-3">
    <!-- Series Details -->
    <div id="series_details">
      <p class="f-s-18 f-w-400 thin m-b-20">{{ series.name }}</p>
      <p class="f-s-14 f-w-300 thin"><i>{{ series.description }}</i></p>
      <p class="m-b-20"><span class="f-s-14 f-w-500 subtle slim-margin m-b-10">Created:</span> <span class="sameline bright f-s-12 f-w-300">{{ series.creation_date|date:'N d, Y' }}</span></p>
      <p style="margin-left:-10px;">
        <span class="sameline subtle">{% if series.sensitive == True %} <i class="fa fa-check-square-o subtle"></i>{% else %}  <i class="fa fa-square subtle"></i>{% endif %}</span><span class="f-s-14 f-w-500 slim-margin m-b-10"> Sensitive</span>
        <br><span class="sameline subtle">{% if series.archived == True %} <i class="fa fa-check-square-o subtle"></i>{% else %}<i class="fa fa-square subtle"></i>{% endif %}</span><span class="f-s-14 f-w-500 slim-margin m-b-10"> Archive</span>
        <br><span class="sameline subtle">{% if series.collaborate == True %} <i class="fa fa-check-square-o subtle"></i>{% else %} <i class="fa fa-square subtle"></i>{% endif %}</span><span class="f-s-14 f-w-500 slim-margin m-b-10"> Collaborate</span>
        <br><span class="sameline subtle">{% if series.share == True %} <i class="fa fa-check-square-o subtle"></i>{% else %} <i class="fa fa-square subtle"></i>{% endif %}</span><span class="f-s-14 f-w-500 slim-margin m-b-10"> Share</span>
      </p>
      {% if series.collaborate == True %}
      <p class="f-s-14 f-w-500 subtle slim-margin m-b-10">Partners: </p>
      {% endif %}
          {% for collaborator in series.collaborate_with.all %}
          <p>{{ collaborator.name }}</p>
          {% endfor %}
      <p class="f-s-14 f-w-500 subtle slim-margin m-b-10">Team: </p>
      {% for user in series.team.all %}
          {% if user.display_photo %}
          <img class="img-circle m-b-5" width="24" src="{{ user.display_photo.url }}" alt="user">
          {% else %}
          <p class="tiny-text">{{ user.first_name }}</p>
          {% endif %}
      {% endfor %}
      <div class="m-t-20">
        <a href="{% url 'series_edit' series.id %}"><button class="btn btn-sm btn-default-200" data-action="confirm">Edit</button></a>
        <form class="series-delete" method="GET"
              action="{% url 'series_delete' series.id %}">
              <!-- onsubmit="return confirm('Do you want to delete this series?')"> -->
              {% csrf_token %}
          <input type="submit" class="btn btn-sm btn-danger-100" value="Delete">
        </form>
      </div>
    </div>


    <!-- Series Discussion -->
    <div id="series_discussion" class="m-t-50">
      {% with view.series_discussion as discussion %}
        <h4 class="m-b-20"> Discussion</h4>
        <div class="comments" data-toggle="slimScroll" style="height:250px" data-color="#5D9CEC" data-allow-page-scroll="false">
              {% for comment in discussion.comments %}
              <div class="row m-b-10">
                  <div class="col-xs-12">
                      <div class="media">
                          <a class="media-left">
                            {% if comment.user.display_photo %}
                              <img class="media-object img-circle h-40 w-40" src="{{ comment.user.display_photo.url }}" alt="user">
                            {% else %}
                              <p class="f-w-300 f-s-12">{{ comment.user.first_name }}</p>
                            {% endif %}
                          </a>
                          <div class="media-body">
                              <p class="f-w-300 f-s-16">{{ comment.text }}
                              <span class="f-w-400 f-s-12 color-default p-r-40" style="float: right;">
                                {{ comment.date|date:'N j' }} at {{ comment.date|date:'g:i a' }}
                              </span>
                              </p>
                          </div>
                      </div>
                  </div>
              </div>
              {% endfor %}
        </div>
        <div class="post-comment">
          <div class="row">
            <form action="{% url 'create_seriescomment' %}" method="POST" class="post-form" role="form">
              <div class="col-md-10 neg-m-r-10">
                  {% csrf_token %}
                  <div class="form-group">
                  {{ discussion.form.text }}
                  </div>
                  {% if discussion.form.text.errors %}
                    <div class="alert alert-warning" role="alert">
                    {{ discussion.form.text.errors }}
                    </div>
                  {% endif %}
                  <!-- Hidden Inputs -->
                  <input type="hidden" name="association" value="series" />
                  <input type="hidden" name="series" value="{{ series.pk }}" />

              </div>
              <div class="col-md-2 neg-m-l-10">
                  <div class="form-group">
                    <button type="submit" class="btn btn-default btn-lg" name="seriescommentform">
                        <i class="fa fa-paper-plane"></i>
                    </button>
                  </div>
                  <!-- <input type="submit" name="seriescommentform" value="Post Comment"/> -->
              </div>
            </form>
          </div>
        </div>
      {% endwith %}
    </div>

  </div>

  <!-- Middle Col -->
  <div class="col-xs-12 col-md-4 col-lg-6">
    <div class="row">
      <div class="col-xs-12">
        <h4 class="m-b-20"><a data-toggle="modal" data-target="#addSeriesTask" title="Add Project Task">
          <i class="fa fa-plus sameline subtle m-r-20"></i>
        </a><a href="{% url 'series_task_list' series.id %}" title="Expand to see more">Tasks <span class="f-s-12 f-w-400 subtle"> (All tasks <i class="fa fa-long-arrow-right subtle" aria-hidden="true">)</i></span></a></h4>
      </div>
    </div>
    <!-- Series Tasks -->
    <div id="series_tasks">
        {% with view.series_tasks as tasks %}
        <div class="row m-b-50">
          <!-- Identified Tasks -->
          <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
            <div class="col-xs-12 task-header">
              <p class="f-s-14 f-w-400 underline-warning underline-120">Identified</p>
            </div>
            <div class="col-xs-12 task-col">
              <div class="displaytasks">
                <div class="activity-widget-5">
                  <div class="row">
                    <div class="col-xs-12 bs-media" id="board-1">
                      {% for task in tasks.tasks %}
                        {% if task.status == "Identified"  %}
                          <div class="media">
                            <a href="{% url 'task_detail' task.id %}" title="View more detail">
                              <div class="media-body">
                                <h5 class="media-heading">
                                  {% if task.important == True %}
                                    <span class="label"><i class="fa fa-star" aria-hidden="true"></i></span>
                                  {% else %}
                                    <span class="label"><i class="fa fa-star-o" aria-hidden="true"></i></span>
                                  {% endif %}
                                  {{ task.name }}
                                </h5>
                                <p>{{ task.text|truncatechars:100 }}</p>
                                <p class="color-warning-300 f-s-8 m-t-10">Due: {{ task.due_date|date:'D, N j, g:i a' }}</p>
                              </div>
                            </a>
                            {% for user in task.assigned_to.all %}
                              {% if user.display_photo %}
                                <a href="{% url 'user_detail' user.id %}" title="See user profile"><img class="img-circle w-20 h-20 m-t-10" src="{{ user.display_photo.url }}" alt="user"></a>
                              {% endif %}
                            {% endfor %}
                          </div>
                        {% endif %}
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- In Progress Tasks -->
          <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
            <div class="col-xs-12 task-header">
              <p class="f-s-14 f-w-400 underline-primary underline-120">In Progress</p>
            </div>
            <div class="col-xs-12 task-col">
              <div class="displaytasks">
                <div class="activity-widget-5">
                  <div class="row">
                    <div class="col-xs-12 bs-media" id="board-2">
                      {% for task in tasks.tasks %}
                        {% if task.status == "In Progress"  %}
                          <div class="media">
                            <a href="{% url 'task_detail' task.id %}" title="View more detail">
                              <div class="media-body">
                                <h5 class="media-heading">
                                  {% if task.important == True %}
                                    <span class="label"><i class="fa fa-star" aria-hidden="true"></i></span>
                                  {% else %}
                                    <span class="label"><i class="fa fa-star-o" aria-hidden="true"></i></span>
                                  {% endif %}
                                  {{ task.name }}
                                </h5>
                                <p>{{ task.text|truncatechars:100 }}</p>
                                <p class="color-primary-500 f-s-10 m-t-10">Due: {{ task.due_date|date:'D, N j, g:i a' }}</p>
                              </div>
                            </a>
                            {% for user in task.assigned_to.all %}
                              {% if user.display_photo %}
                                <a href="{% url 'user_detail' user.id %}" title="See user profile"><img class="img-circle w-20 h-20 m-t-10" src="{{ user.display_photo.url }}" alt="user"></a>
                              {% endif %}
                            {% endfor %}
                          </div>
                        {% endif %}
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Complete Tasks -->
          <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
            <div class="col-xs-12 task-header">
              <p class="f-s-14 f-w-400 underline-success underline-120">Complete</p>
            </div>
            <div class="col-xs-12 task-col">
              <div class="displaytasks">
                <div class="activity-widget-5">
                  <div class="row">
                    <div class="col-xs-12 bs-media" id="board-3">
                      {% for task in tasks.tasks %}
                        {% if task.status == "Complete"  %}
                          <div class="media">
                            <a href="{% url 'task_detail' task.id %}" title="View more detail">
                              <div class="media-body">
                                <h5 class="media-heading">
                                  {% if task.important == True %}
                                    <span class="label"><i class="fa fa-star" aria-hidden="true"></i></span>
                                  {% else %}
                                    <span class="label"><i class="fa fa-star-o" aria-hidden="true"></i></span>
                                  {% endif %}
                                  {{ task.name }}
                                </h5>
                                <p>{{ task.text|truncatechars:100 }}</p>
                                <p class="color-success-300 f-s-12 m-t-10">Due: {{ task.due_date|date:'D, N j, g:i a' }}</p>
                              </div>
                            </a>
                            {% for user in task.assigned_to.all %}
                              {% if user.display_photo %}
                                <a href="{% url 'user_detail' user.id %}" title="See user profile"><img class="img-circle w-20 h-20 m-t-10" src="{{ user.display_photo.url }}" alt="user"></a>
                              {% endif %}
                            {% endfor %}
                          </div>
                        {% endif %}
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endwith %}
    </div>

  </div>

  <!-- Right Col -->
  <div class="col-xs-12 col-md-4 col-lg-3">

    <!-- Series Notes -->
    <div id="series_notes">
      {% with view.series_notes as notes %}
      <h4 class="m-b-20">
        <a data-toggle="modal" data-target="#addSeriesNote" title="Add Series Note">
          <i class="fa fa-plus sameline subtle m-r-20"></i>
        </a>
        Notes
        <a href="{% url 'series_notes' pk=series.id %}" class="link-text m-b-40 subtle">
          <span class="f-s-12 f-w-400 subtle"> (All notes <i class="fa fa-long-arrow-right subtle" aria-hidden="true">)</i></span>
        </a>
      </h4>

        {% for note in notes.notes %}
          <div class="col-xs-12">
            <div class="card bs-card">
                <div class="card-block">
                    <a data-toggle="modal" data-target="#viewNote{{note.id}}" title="View Organization Note"><h4 class="f-s-16 f-w-500 m-b-20">{{ note.title }}</h4></a>
                    <p class="card-text color-default f-s-12">{{ note.owner.credit_name }}
                        <br>{{ note.creation_date|date:'N j' }}, {{ note.creation_date|date:'g:i a' }}</p>
                </div>
            </div>
          </div>
        {% endfor %}
        <a href="{% url 'series_notes' pk=series.id %}" class="link-text m-b-40 subtle"><small>See all notes...</small></a>
      {% endwith %}
    </div>

    <!-- Series Stories -->
    <div id="series-stories" class="m-t-50">
      <h4 class="m-b-20"><a href="{% url 'story_new' %}" title="Add A Story"><i class="fa fa-plus sameline subtle m-r-10 m-l-0"></i></a> Stories <a href="#" title="View Stories"><span class="f-s-12 f-w-400 subtle"> (All stories <i class="fa fa-long-arrow-right subtle" aria-hidden="true">)</i></span></a></h4>
      {% with view.stories as stories %}
      <div class="row m-b-20">
        <div class="col-xs-12">
          {% for story in stories.stories %}
          <a href="{% url 'story_detail' story.id %}" class="f-s-14">{{ story.name }}</a>
          {% endfor %}
        </div>
      </div>
      {% endwith %}
    </div>


    <!-- Series Events -->
    <div id="series_events" class="m-t-50">
      <h4 class="m-b-20">Engagement</h4>
      {% with view.series_events as events %}
      <div class="row m-b-20">
        <div class="col-xs-12">
          <p class="f-s-16 f-w-600 subtle slim-margin">Events:</p>
          {% for event in events.events %}
          <p><i class="fa fa-calendar" aria-hidden="true"></i>  <a href="{% url 'event_detail' pk=event.id %}" title="See event details">{{ event.name }}</a>
            <br><span class="card-text color-default f-s-12"> {{ event.event_date|date:'N j, g:i a'}}</span></p>
          {% endfor %}
        </div>
      </div>
      {% endwith %}
    </div>

    {% comment %}
    <!-- Series Calendar -->
    <div id="series_calendar">
      <h4 class="m-b-20">Calendar</h4>
      <div id="calendar"></div>
    </div>
    {% endcomment %}

  </div>
</div>

<!-- ================================================= -->
                  <!-- JS SCRIPTS -->
<!-- ================================================= -->

<!-- Confirmation alerts -->
<script>
    $('.series-delete input').on('click', function(e) {
         e.preventDefault();
            swal({
                title: 'Are you sure?',
                text: 'You will not be able to recover this series.',
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!',
                closeOnConfirm: true
            }, function(result) {
                if (result) {
                  $(".series-delete").attr("method", "POST").submit();
                } else {
                  // do nothing on cancel
              }
            });
          });
  </script>


{% endblock %}

{% block modals %}

<!-- ================================================= -->
              <!-- ADD STORYNOTE MODAL -->
<!-- ================================================= -->

{% with view.series_notes as notes %}
  <div class="modal fade" id="addSeriesNote" tabindex="-1" role="dialog" aria-labelledby="addSeriesNoteModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h5 class="modal-title" id="addStoryNoteLabel">Add a note for this series</h5>
        </div>
        <div class="modal-body">
          <form action="{% url 'create_seriesnote' %}" method="POST" class="post-form">
          {% csrf_token %}
          {% bootstrap_form notes.form %}
          <!-- Hidden Inputs -->
          <input type="hidden" name="association" value="series" />
          <input type="hidden" name="series" value="{{ series.pk }}" />
          <button type="submit" class="btn btn-primary m-t-20">Post Note</button>
          </form>
        </div>
        <div class="modal-footer">
        </div>
      </div>
    </div>
  </div>
  {% for note in notes.notes %}
  <!-- View Note Modals -->
  <div class="modal fade" id="viewNote{{note.id}}" tabindex="-1" role="dialog" aria-labelledby="viewNote{{note.id}}">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="viewNote{{note.id}}Label">{{ note.title }}</h4>
        </div>
        <div class="modal-body">
          {{ note.text|linebreaksbr }}
        </div>
        <div class="modal-footer">
          <p class="tiny-text">{{ note.owner }} | {{ note.creation_date|date:'D M j g:i a' }}<p>
        </div>
      </div>
    </div>
  </div>
  <!-- END View Note Modals -->
  {% endfor %}
{% endwith %}
{% endblock modals %}
