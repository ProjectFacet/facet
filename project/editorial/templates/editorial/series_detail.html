{% extends 'base.html' %}

{% load i18n %}
{% load bootstrap3 %}
{% load staticfiles %}

<!-- ====================================== -->
<!--      BREADCRUMB NAVIGATION             -->
<!-- ====================================== -->

{% block breadcrumb %}
<div>
    <ol class="breadcrumb pull-left icon-angle-right icon-th">
        <li class="fadeIn"><a href="{% url 'dashboard' %}" title="Go to Dashboard"> Dashboard </a></li>
        <li class="fadeIn"><a href="{% url 'series_list' %}" title="View Series"> Series </a></li>
        <li class="fadeIn"> {{ series.name }}</li>
    </ol>
    <ol class="breadcrumb pull-right">
        <li class="fadeIn"><a href="#" data-toggle="modal" data-target="#seriesDetailGuide" title="Here's what you can do on this page.">What's on this page?</a></li>
    </ol>
</div>
{% endblock breadcrumb %}

<!-- ====================================== -->
<!--            Main Section                -->
<!-- ====================================== -->

{% block content %}

<!-- Row One -->
<div class="row m-b-40">
    <!-- Left Column -->
    <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
      <!-- Detail -->
        <h4 class="m-b-20">Detail</h4>
        <div class="row m-b-20">
          <!-- Series Edit -->
          <div class="col-xs-4 col-sm-2">
              <a href="{% url 'series_edit' series.id %}" title="Edit series details"><i class="fa fa-pencil-square-o subtle fa-lg" aria-hidden="true"></i></a>
          </div>
          <!-- Series Delete -->
          <div class="col-xs-4 col-sm-2">
            <form class="series-delete" method="GET"
                  action="{% url 'series_delete' pk=series.id %}">
                  <!-- onsubmit="return confirm('Do you want to delete this task?')"> -->
                  {% csrf_token %}
              <a href="javascript:$('.series-delete').submit();" title="Delete the series"><i class="fa fa-trash subtle fa-lg" aria-hidden="true"></i></a>
            </form>
          </div>
          <div class="col-xs-4 col-sm-8">
          </div>
        </div>
        <p class="f-s-18 f-w-400 thin m-b-20">{{ series.name }}</p>
        <p class="f-s-14 f-w-300 thin"><i>{{ series.description }}</i></p>
        <p class="m-b-20"><span class="f-s-14 f-w-500 subtle slim-margin m-b-10">Series Start:</span> <span class="sameline bright f-s-12 f-w-300">{{ series.creation_date|date:'N d, Y' }}</span></p>
        <p style="margin-left:-10px;">
          <span class="sameline subtle">{% if series.sensitive == True %} <i class="fa fa-check-square-o subtle"></i>{% else %}  <i class="fa fa-square subtle"></i>{% endif %}</span><span class="f-s-14 f-w-500 slim-margin m-b-10"> Sensitive</span>
          <br><span class="sameline subtle">{% if series.archived == True %} <i class="fa fa-check-square-o subtle"></i>{% else %}<i class="fa fa-square subtle"></i>{% endif %}</span><span class="f-s-14 f-w-500 slim-margin m-b-10"> Archive</span>
          <br><span class="sameline subtle">{% if series.collaborate == True %} <i class="fa fa-check-square-o subtle"></i>{% else %} <i class="fa fa-square subtle"></i>{% endif %}</span><span class="f-s-14 f-w-500 slim-margin m-b-10"> Collaborate</span>
        </p>
        {% if series.collaborate == True %}
        <p class="f-s-14 f-w-500 subtle slim-margin m-b-10">Partners: </p>
        {% endif %}
            {% for collaborator in series.collaborate_with.all %}
            <p>{{ collaborator.name }}</p>
            {% endfor %}
        <p class="f-s-14 f-w-500 subtle slim-margin m-b-10">Team: </p>
        {% for user in series.team.all %}
            {% if user.display_photo %}
            <img class="img-circle m-b-5" width="32" src="{{ user.display_photo.url }}" alt="user">
            {% else %}
            <p class="tiny-text">{{ user.first_name }}</p>
            {% endif %}
        {% endfor %}
    </div>
    <!-- End of Left Column -->

    <!-- Middle Column -->
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
      <!-- Tasks -->
      {% with view.series_tasks as tasks %}
      <div class="row">
        <div class="col-xs-12">
          <h4 class="m-b-20"><a data-toggle="modal" data-target="#addSeriesTask" title="Add Series Task">
            <i class="fa fa-plus sameline subtle m-r-20"></i>
          </a><a href="{% url 'series_task_list' series.id %}" title="Expand to see more">Tasks <span class="f-s-12 f-w-400 subtle"> (All tasks <i class="fa fa-long-arrow-right subtle" aria-hidden="true">)</i></span></a></h4>
        </div>
      </div>
      <div class="row m-b-50">
        <div class="col-xs-12">

          <!-- Identified Tasks -->
          <div>
            <a href="{% url 'series_task_list' series.id %}" title="Expand to see more"><p class="f-s-16 f-w-400 underline-warning underline-120">Identified <span class="subtle f-s-14 f-w-600">({{ tasks.identified_ct }})</span></p></a>
          </div>
          <div class="activity-widget-1">
            <div class="row">
              <div class="col-xs-12">
                <ul class="list-group">
                  {% for task in tasks.identified|slice:":2" %}
                    {% if task.status == "Identified" %}
                      <li class="list-group-item">
                        <span class="color-warning-300 text-xs pull-right">{{ task.due_date|date:'D, N j, g:i a' }}</span>
                        <span class="pull-left">
                          {% for user in task.assigned_to.all|slice:":1" %}
                              {% if user.display_photo %}
                                <img class="media-object img-circle h-25 w-25" src="{{ user.display_photo.url }}" alt="user">
                              {% else %}
                                <img class="media-object img-circle h-25 w-25" src="{% static 'images/nophoto.jpg' %}" alt="user">
                              {% endif %}
                          {% endfor %}
                        </span>
                        {% if task.assigned_to.count > 1 %}
                        <span class="pull-left text-xs color-warning-300">+ {{ task.assigned_to.count|add:"-1" }}</span>
                        {% endif %}
                        <span class="m-l-30">
                          {% if task.important == True %}
                              <span class="label"><i class="fa fa-star" aria-hidden="true"></i></span>
                          {% else %}
                              <span class="label"><i class="fa fa-star-o" aria-hidden="true"></i></span>
                          {% endif %}
                          <a href="{% url 'task_detail'  task.id %}" title="Go to task details">{{ task.name }}</a>
                        </span>
                      </li>
                    {% endif %}
                  {% endfor %}
                 </ul>
               </div>
             </div>
           </div>

          <!-- In Progress Tasks -->
          <div class="m-t-20">
            <a href="{% url 'series_task_list' series.id %}" title="Expand to see more"><p class="f-s-16 f-w-400 underline-primary underline-120">In Progress <span class="subtle f-s-14 f-w-600">({{ tasks.inprogress_ct }})</span></p></a>
          </div>
          <div class="activity-widget-1">
            <div class="row">
              <div class="col-xs-12">
                <ul class="list-group">
                  {% for task in tasks.inprogress|slice:":2" %}
                    {% if task.status == "In Progress"  %}
                      <li class="list-group-item">
                        <span class="color-primary-300 text-xs pull-right">{{ task.due_date|date:'D, N j, g:i a' }}</span>
                        <span class="pull-left">
                          {% for user in task.assigned_to.all|slice:":1" %}
                            {% if user.display_photo %}
                              <img class="media-object img-circle h-25 w-25" src="{{ user.display_photo.url }}" alt="user">
                            {% else %}
                              <img class="media-object img-circle h-25 w-25" src="{% static 'images/nophoto.jpg' %}" alt="user">
                            {% endif %}
                          {% endfor %}
                        </span>
                        {% if task.assigned_to.count > 1 %}
                        <span class="pull-left text-xs color-primary-300">+ {{ task.assigned_to.count|add:"-1" }}</span>
                        {% endif %}
                        <span class="m-l-30">
                          {% if task.important == True %}
                              <span class="label"><i class="fa fa-star" aria-hidden="true"></i></span>
                          {% else %}
                              <span class="label"><i class="fa fa-star-o" aria-hidden="true"></i></span>
                          {% endif %}
                          <a href="{% url 'task_detail'  task.id %}" title="Go to task details">{{ task.name }}</a>
                        </span>
                      </li>
                    {% endif %}
                  {% endfor %}
                 </ul>
               </div>
             </div>
           </div>

          <!-- Complete Tasks -->
          <div class="m-t-20">
            <a href="{% url 'series_task_list' series.id %}" title="Expand to see more"><p class="f-s-16 f-w-400 underline-success underline-120">Complete <span class="subtle f-s-14 f-w-600">({{ tasks.complete_ct }})</span></p></a>
          </div>
          <div class="activity-widget-1">
            <div class="row">
              <div class="col-xs-12">
                <ul class="list-group">
                  {% for task in tasks.complete|slice:":2" %}
                    {% if task.status == "Complete"  %}
                      <li class="list-group-item">
                        <span class="color-success-300 text-xs pull-right">{{ task.due_date|date:'D, N j, g:i a' }}</span>
                        <span class="pull-left">
                          {% for user in task.assigned_to.all|slice:":1" %}
                            {% if user.display_photo %}
                              <img class="media-object img-circle h-25 w-25" src="{{ user.display_photo.url }}" alt="user">
                            {% else %}
                              <img class="media-object img-circle h-25 w-25" src="{% static 'images/nophoto.jpg' %}" alt="user">
                            {% endif %}
                          {% endfor %}
                        </span>
                        {% if task.assigned_to.count > 1 %}
                        <span class="pull-left text-xs color-success-300">+ {{ task.assigned_to.count|add:"-1" }}</span>
                        {% endif %}
                        <span class="m-l-30">
                          {% if task.important == True %}
                              <span class="label"><i class="fa fa-star" aria-hidden="true"></i></span>
                          {% else %}
                              <span class="label"><i class="fa fa-star-o" aria-hidden="true"></i></span>
                          {% endif %}
                          <a href="{% url 'task_detail'  task.id %}" title="Go to task details">{{ task.name }}</a>
                        </span>
                      </li>
                    {% endif %}
                  {% endfor %}
                 </ul>
               </div>
             </div>
           </div>

        </div>
      </div>
      {% endwith %}
    </div>
    <!-- End of Middle Column -->

    <!-- Right Column -->
    <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
      <h4 class="m-b-10">Discussion</h4>
      {% with view.series_discussion as discussion %}
      <!-- Display Comments -->
      <div class="discussion-container">
          <div class="row">
            {% for comment in discussion.comments %}
              <div class="col-md-10">
                <p class="f-s-12">{{ comment.text }} <span class="f-s-10 color-default">| {{ comment.date|date:'D, M j, g:i a' }}</span></p>
              </div>
              <div class="col-md-2">
                {% if comment.user.display_photo %}
                <a href="" title="{{ comment.user.first_name }}"><img class="media-object img-circle neg-m-l-10" width="32" src="{{ comment.user.display_photo.url }}" alt="user"></a>
                {% else %}
                {% endif %}
              </div>
            {% endfor %}
          </div>
      </div>
      <!-- Comment Form -->
      <div class="comment">
          <div class="row">
            <form action="{% url 'create_seriescomment' %}" method="POST" class="post-form" role="form">
              <div class="col-xs-12">
                  {% csrf_token %}
                  <div class="input-group">
                    {{ discussion.form.text }}

                    {% if discussion.form.text.errors %}
                      <div class="alert alert-warning" role="alert">
                      {{ discussion.form.text.errors }}
                      </div>
                    {% endif %}
                    <!-- Hidden Inputs -->
                    <input type="hidden" name="association" value="series" />
                    <input type="hidden" name="series" value="{{ series.pk }}" />
                    <span class="input-group-btn">
                      <button id="seriescommentbutton" class="btn btn-default btn-lg" type="submit" name="seriescommentform"><i class="fa fa-paper-plane"></i></button>
                    </span>
                  </div>
              </div>
            </form>
          </div>
      </div>
      {% endwith %}
    </div>
    <!-- End of Right Column -->
</div>
<!-- End of Row One -->

<!-- Row Two -->
<div class="row m-b-40">
  <!-- Left Column -->
  <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
    <!-- Calendar -->
    <h4 class="m-b-20">Calendar</h4>
    <div id="calendar"></div>
  </div>
  <!-- End of Left Column -->

  <!-- Middle Column -->
  <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
    <!-- Content -->
    <div class="row">
      <div class="col-xs-12">
        <h4 class="m-b-20"><a href="{% url 'story_new' %}" title="Add A Story"><i class="fa fa-plus sameline subtle m-r-10 m-l-0"></i></a> Stories
          {% comment %}
          <a href="{% url 'series_stories' series.id %}" title="View Stories"><span class="f-s-12 f-w-400 subtle"> (All stories <i class="fa fa-long-arrow-right subtle" aria-hidden="true">)</i></span></a>
          {% endcomment %}
        </h4>
        <table class="table table-hover table-striped table-sm table-unbordered" cellspacing="0" width="100%">
          <thead>
            <td>Story</td>
            <td>Facets</td>
          </thead>
          <tbody>
            {% for story in series.story_set.all %}
              <tr>
                <td><a href="{% url 'story_detail' story.id %}" class="f-s-14">{{ story.name }}</a></td>
                <td>{{ story.facet_set.count }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div>
  <!-- End of Middle Column -->

  <!-- Right Column -->
  <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
    <!-- Series Media -->
    {% with view.series_assets as assets %}
    <!-- Images and Documents -->
    <div class="row">
      <div class="col-xs-12">
      <h4 class="m-b-20">Story Media <a href="{% url 'series_assets' series.id %}" title="View Series"><span class="f-s-12 f-w-400 subtle"> (All media <i class="fa fa-long-arrow-right subtle" aria-hidden="true">)</i></span></a></h4>
      </div>
      <!-- Images -->
      <div class="col-xs-12 col-sm-6">
        <p class="f-s-12 f-w-400 subtle">Images</p>
        <div class="row" id="series-thumbs">
        {% for image in assets.images|slice:":6" %}
          {% if image.display_photo %}
            <div class="col-xs-6">
              <a href="{{ image.display_photo.url }}" class="thumbnail"><img src="{{ image.display_photo.url }}" alt="{{ image.description }}" class="img-fluid m-b-10"></a>
            </div>
            {% if forloop.counter|divisibleby:"2" and not forloop.last %}
              </div><div class="row">
            {% endif %}
          {% endif %}
        {% endfor %}
        </div>
      </div>
      <!-- Documents -->
      <div class="col-xs-12 col-sm-6">
        <p class="f-s-12 f-w-400 subtle">Documents</p>
        <div class="row" id="series-thumbs">
          <div class="col-xs-12">
          {% for document in assets.documents|slice:":4" %}
              {% if document.asset_type == 'OTHER' %}
              <a href="{{ document.document.url }}" title="{{ document.description }}" target="_blank"><p class="f-r-8 f-w-300 m-l-10"><i class="fa fa-file-file-o dark m-r-10"></i> {{ document.title }}</p></a>
              {% endif %}
              {% if document.asset_type == 'TEXT' %}
              <a href="{{ document.document.url }}" title="{{ document.description }}" target="_blank"><p class="f-r-8 f-w-300 m-l-10"><i class="fa fa-file-text-o dark m-r-10"></i> {{ document.title }}</p></a>
              {% endif %}
              {% if document.asset_type == 'WORD DOC' %}
              <a href="{{ document.document.url }}" title="{{ document.description }}" target="_blank"><p class="f-r-8 f-w-300 m-l-10"><i class="fa fa-file-word-o dark m-r-10"></i> {{ document.title }}</p></a>
              {% endif %}
              {% if document.asset_type == 'EXCEL' %}
              <a href="{{ document.document.url }}" title="{{ document.description }}" target="_blank"><p class="f-r-8 f-w-300 m-l-10"><i class="fa fa-file-excel-o dark m-r-10"></i> {{ document.title }}</p></a>
              {% endif %}
              {% if document.asset_type == 'PDF' %}
              <a href="{{ document.document.url }}" title="{{ document.description }}" target="_blank"><p class="f-r-8 f-w-300 m-l-10"><i class="fa fa-file-pdf-o dark m-r-10"></i> {{ document.title }}</p></a>
              {% endif %}
              {% if document.asset_type == 'COMMA SEPARATED' %}
              <a href="{{ document.document.url }}" title="{{ document.description }}" target="_blank"><p class="f-r-8 f-w-300 m-l-10"><i class="fa fa-file-o dark m-r-10"></i> {{ document.title }}</p></a>
              {% endif %}
          {% endfor %}
          </div>
        </div>
      </div>
    </div>
    <!-- Audio and Video -->
    <div class="row m-t-20">
      <!-- Audio -->
      <div class="col-xs-12 col-sm-6">
        <p class="f-s-12 f-w-400 subtle">Audio</p>
        <div class="row" id="series-audio">
          {% for audio in assets.audio|slice:":4" %}
            <div class="col-xs-12 m-l-10">
              {% if audio.asset_type == 'MP3' or audio.asset_type == 'WAV' %}
              <div id="jplayer_audio_{{audio.pk}}" class="jp-jplayer"></div>

              <div id="jp_container_audio_{{audio.pk}}" class="jp-flat-audio" role="application" aria-label="media player">
                <div class="jp-play-control jp-control">
                  <button class="jp-play jp-button" role="button" aria-label="play" tabindex="0"></button>
                </div>
                <div class="jp-bar">
                  <div class="jp-seek-bar jp-seek-bar-display"></div>
                  <div class="jp-seek-bar">
                    <div class="jp-play-bar"></div>
                    <div class="jp-details"><span class="jp-title" aria-label="title"></span></div>
                    <div class="jp-timing"><span class="jp-duration" role="timer" aria-label="duration"></span></div>
                  </div>
                </div>
                <div class="jp-no-solution">
                  Media Player Error<br />
                  Update your browser or Flash plugin
                </div>
              </div>
              <script>
                jQuery(document).ready(function($) {
                  $("#jplayer_audio_{{audio.pk}}").jPlayer({
                    ready: function(event) {
                      $(this).jPlayer("setMedia", {
                        title: "{{audio.title}}",
                        wav: "{{audio.audio.url}}",
                        mp3: "{{audio.audio.url}}",
                      });
                    },
                    play: function() { // Avoid multiple jPlayers playing together.
                      $(this).jPlayer("pauseOthers");
                    },
                    timeFormat: {
                      padMin: false
                    },
                    swfPath: "js",
                    supplied: "wav, mp3",
                    cssSelectorAncestor: "#jp_container_audio_{{audio.pk}}",
                    useStateClassSkin: true,
                    autoBlur: false,
                    smoothPlayBar: true,
                    remainingDuration: true,
                    keyEnabled: true,
                    keyBindings: {
                      // Disable some of the default key controls
                      loop: null,
                      muted: null,
                      volumeUp: null,
                      volumeDown: null
                    },
                    wmode: "window"
                  });
                });
              </script>
              {% endif %}
              {% if audio.asset_type == 'SC' %}
              <a href="{{ audio.link }}" title="{{ audio.description }}" target="_blank"><i class="fa fa-soundcloud sameline"></i> <span class="small-text dark sameline">{{ audio.title }}</span></a>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </div>
      <!-- Video -->
      <div class="col-xs-12 col-sm-6">
        <p class="f-s-12 f-w-400 subtle">Video</p>
        <div class="row" id="series-video">
          <div class="col-xs-12">
            {% for video in assets.video|slice:":4" %}
              {% if video.asset_type == 'MP4' %}
              <div id="jp_container_video_{{video.pk}}" class="jp-flat-video m-b-10" role="application" aria-label="media player">
                <div id="jplayer_video_{{video.pk}}" class="jp-jplayer"></div>
                <div class="jp-gui">
                  <div class="jp-play-control jp-control">
                    <button class="jp-play jp-button" role="button" aria-label="play" tabindex="0"></button>
                  </div>
                  <div class="jp-bar">
                    <div class="jp-seek-bar jp-seek-bar-display"></div>
                    <div class="jp-seek-bar">
                      <div class="jp-play-bar"></div>
                      <div class="jp-details"><span class="jp-title" aria-label="title"></span></div>
                      <div class="jp-timing"><span class="jp-duration" role="timer" aria-label="duration"></span></div>
                    </div>
                  </div>
                  <div class="jp-screen-control jp-control">
                    <button class="jp-full-screen jp-button" role="button" aria-label="full screen" tabindex="0"></button>
                  </div>
                </div>
                <div class="jp-no-solution">
                  Media Player Error<br />
                  Update your browser or Flash plugin
                </div>
              </div>
              <script>
                  $(document).ready(function($) {
                  $("#jplayer_video_{{video.pk}}").jPlayer({
                    ready: function(event) {
                      var $this = $(this).jPlayer("setMedia", {
                        title: "Big Buck Bunny Trailer",
                        m4v: "http://jplayer.org/video/m4v/Big_Buck_Bunny_Trailer.m4v",
                        ogv: "http://jplayer.org/video/ogv/Big_Buck_Bunny_Trailer.ogv",
                        webmv: "http://jplayer.org/video/webm/Big_Buck_Bunny_Trailer.webm",
                        poster: "http://jplayer.org/video/poster/Big_Buck_Bunny_Trailer_480x270.png"
                      });

                      // Fix GUI when Full Screen button is hidden.
                      if(event.jPlayer.status.noFullWindow) {
                        var $anc = $($this.jPlayer("option", "cssSelectorAncestor"));
                        $anc.find('.jp-screen-control').hide();
                        $anc.find('.jp-bar').css({"right":"0"});
                      }

                      // Fix the responsive size for iOS and Flash.
                      var fix_iOS_flash = function() {
                        var w = $this.data("jPlayer").ancestorJq.width(),
                          h = w * 9 / 16; // Change to suit your aspect ratio. Used 16:9 HDTV ratio.
                        $this.jPlayer("option", "size", {
                          width: w + "px",
                          height: h + "px"
                        });
                      };
                      var plt = $.jPlayer.platform;
                      if(plt.ipad || plt.iphone || plt.ipod || event.jPlayer.flash.used) {
                        $(window).on("resize", function() {
                          fix_iOS_flash();
                        });
                        fix_iOS_flash();
                      }
                    },
                    timeFormat: {
                      padMin: false
                    },
                    swfPath: "js",
                    supplied: "webmv, ogv, m4v",
                    cssSelectorAncestor: "#jp_container_video_{{video.pk}}",
                    // See the CSS for more info on changing the size.
                    size: {
                      width: "100%",
                      height: "auto",
                      cssClass: "jp-flat-video-responsive"
                    },
                    sizeFull: {
                      cssClass: "jp-flat-video-full"
                    },
                    autohide: {
                      full: false,
                      restored: false
                    },
                    // While playing, allow the GUI to hide
                    play: function() {
                      $(this).jPlayer("option", "autohide", {
                        full: true,
                        restored: true
                      });
                      // Avoid multiple jPlayers playing together.
                      $(this).jPlayer("pauseOthers");
                    },
                    // When paused, show the GUI
                    pause: function() {
                      $(this).jPlayer("option", "autohide", {
                        full: false,
                        restored: false
                      });
                    },
                    // Enable clicks on the video to toggle play/pause
                    click: function(event) {
                      if(event.jPlayer.status.paused) {
                        $(this).jPlayer("play");
                      } else {
                        $(this).jPlayer("pause");
                      }
                    },
                    useStateClassSkin: true,
                    autoBlur: false,
                    smoothPlayBar: !($.jPlayer.browser.msie && $.jPlayer.browser.version < 9), // IE8 did not like the hidden animated progress bar.
                    remainingDuration: true,
                    keyEnabled: true,
                    keyBindings: {
                      // Disable some of the default key controls
                      loop: null,
                      muted: null,
                      volumeUp: null,
                      volumeDown: null
                    }
                  });
                });
              </script>
              {% endif %}

              {% if video.asset_type == 'YOUTUBE' %}
              <a href="{{ video.link }}" title="View {{ video.title }}" class="embedded-video"><p class="f-r-8 f-w-300 m-l-10"><i class="fa fa-youtube-play dark m-r-10"></i> {{ video.title }}</p></a>
              {% endif %}
              {% if video.asset_type == 'VIMEO' %}
              <a href="{{ video.link }}" title="View {{ video.title }}" class="embedded-video"><p class="f-r-8 f-w-300 m-l-10"><i class="fa fa-vimeo dark m-r-10"></i> {{ video.title }}</p></a>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    {% endwith %}
  </div>
  <!-- End of Right Column -->

</div>
<!-- End of Row Two -->

<!-- Row Three -->
<div class="row m-b-40">
  <!-- Left Column -->
  <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
    <!-- Events -->
    <h4 class="m-b-20">
      <a data-toggle="modal" data-target="#addEvent" title="Add Event">
        <i class="fa fa-plus sameline subtle m-r-20"></i>
      </a>
      Events
      <a href="{% url 'series_event_list' pk=series.id %}" class="link-text m-b-40 subtle">
        <span class="f-s-12 f-w-400 subtle"> (All events <i class="fa fa-long-arrow-right subtle" aria-hidden="true">)</i></span>
      </a>
    </h4>
    {% with view.series_events as events %}
    <div class="row m-b-20">
      <div class="col-xs-12">
        {% for event in events.events|slice:":5" %}
        <p><i class="fa fa-calendar" aria-hidden="true"></i>  <a href="{% url 'event_detail' pk=event.id %}" title="See event details">{{ event.name }}</a>
          <br><span class="card-text color-default f-s-12"> {{ event.event_date|date:'N j, g:i a'}}</span></p>
        {% endfor %}
      </div>
    </div>
    <div class="row m-b-20">
      <div class="col-xs-12">
        {% comment %}
        <p class="f-s-16 f-w-600 subtle slim-margin">Social Posts:</p>
        {% endcomment %}
      </div>
    </div>
    {% endwith %}
  </div>
  <!-- End of Left Column -->

  <!-- Middle Column -->
  <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
    <!-- Series Assets -->
    <h4 class="m-b-20">Series Assets</h4>
      <div class="row">
      <!-- Images -->
      {% with view.simple_images as images %}
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <p class="f-r-12 f-w-300 m-b-20">Images <a href="#" data-toggle="modal" data-target="#SimpleImageAssetModal" title="Add Image"><i class="fa fa-plus sameline subtle"></i></a></p>
        <div id="image-thumbs">
          <div class="row m-b-10">
            {% for image in images.images %}
              {% if image.display_photo %}
                <div class="col-xs-6">
                  <a href="{{ image.display_photo.url }}" class="thumbnail"><img src="{{ image.display_photo.url }}" alt="{{ image.description }}" class="img-fluid"></a>
                </div>
                {% if forloop.counter|divisibleby:"3" and not forloop.last %}
                  </div><div class="row m-b-10">
                {% endif %}
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
      {% endwith %}
      <!-- Documents -->
      {% with view.simple_documents as documents %}
      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <p class="f-r-12 f-w-300 m-b-20">Documents <a href="#" data-toggle="modal" data-target="#SimpleDocumentAssetModal" title="Add Document"><i class="fa fa-plus sameline subtle"></i></a></p>
        {% for document in documents.documents %}
          <a href="{{ document.document.url }}" target="_blank"><p class="f-w-300 m-l-10 f-r-9"><i class="fa fa-file subtle m-r-5"></i> {{ document.title }}</p></a>
          {% if forloop.counter|divisibleby:"2" and not forloop.last %}
          {% endif %}
        {% endfor %}
      </div>
      {% endwith %}
      </div>
  </div>
  <!-- End of Middle Column -->

  <!-- Right Column -->
  <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
    <!-- Notes -->
    <div class="seriesnotes">
      {% with view.series_notes as notes %}
        <h4 class="m-b-20">
          <a data-toggle="modal" data-target="#addSeriesNote" title="Add Series Note">
            <i class="fa fa-plus sameline subtle m-r-20"></i>
          </a>
          Notes
          <a href="{% url 'series_notes' pk=series.id %}" class="link-text m-b-40 subtle">
            <span class="f-s-12 f-w-400 subtle"> (All notes <i class="fa fa-long-arrow-right subtle" aria-hidden="true">)</i></span>
          </a>
        </h4>
        <div id="displaynotes" class="activity-widget-4">
          {% for note in notes.notes|slice:":5" %}
            <div class="row">
                <div class="col-xs-12">
                  <div class="media">
                    <div class="media-body">
                      <h5 class="media-heading">
                        {% if note.important == True %}
                        <i class="fa fa-star f-r-8 color-warning-100" aria-hidden="true"></i>
                        {% else %}
                        <i class="fa fa-star-o f-r-8 subtle" aria-hidden="true"></i>
                        {% endif %}
                        <a data-toggle="modal" data-target="#viewNote{{note.id}}" title="View Story Note"> {{ note.title }} </a>
                      </h5>
                      <small class="color-default">{{ note.creation_date|date:'N j, g:i a' }}</small>
                      <!-- Note Delete -->
                      <form class="note-delete sameline" method="GET"
                            action="{% url 'note_delete' note.id %}">
                            {% csrf_token %}
                        <a href="javascript:$('.note-delete').submit();"><i class="fa fa-trash subtle float-right" style="float:right;" aria-hidden="true"></i></a>
                      </form>
                    </div>
                  </div>
                </div>
            </div>
          {% endfor %}
        </div>
      {% endwith %}
    </div>
  </div>
  <!-- End of Middle Column -->

</div>
<!-- End of Row Three -->



<!-- ================================================= -->
<!-- ================================================= -->
                  <!-- JS SCRIPTS -->
<!-- ================================================= -->
<!-- ================================================= -->

<!-- Chosen, Thumbnails, Image Library -->
<script>
  $(".chosen-select").chosen()

  $('#series-thumbs').magnificPopup({
    delegate: 'a',
    type: 'image',
    gallery: {enabled:true}
  });

  $('.image-library').magnificPopup({
    delegate: 'a',
    type: 'image',
    gallery: {enabled:true}
  });

  $('#image-thumbs').magnificPopup({
    delegate: 'a',
    type: 'image',
    gallery: {enabled:true}
  });

</script>

<!-- Embedded Video -->
<script>
    $('.embedded-video').magnificPopup({
      type: 'iframe',
      iframe: {
          patterns: {
              youtube: {
                  index: 'youtu.be/',
                  id: function(url) {
                      var m = url.match(/[\\?\\&]v=([^\\?\\&]+)/);
                      if ( !m || !m[1] ) return null;
                      return m[1];
                  },
                  src: '//www.youtube.com/embed/%id%?autoplay=1'
              },
              vimeo: {
                  index: 'vimeo.com/',
                  id: function(url) {
                      var m = url.match(/(https?:\/\/)?(www.)?(player.)?vimeo.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/);
                      if ( !m || !m[5] ) return null;
                      return m[5];
                  },
                  src: '//player.vimeo.com/video/%id%?autoplay=1'
              }
          }
      }
    });

  </script>

<!-- Series Schedule -->
<!-- <script>
    (function() {
        'use strict';

        $(function() {
            var events_array = $.get('{% url "series_schedule" series.id %}')
            $('#calendar').fullCalendar({
                dayClick: function(date, jsEvent, view) {
                    console.log('Clicked on: ' + date.format());
                    console.log('Event: ', jsEvent);
                    console.log('Coordinates: ' + jsEvent.pageX + ',' + jsEvent.pageY);
                    console.log('Current view: ' + view.name);
                    //$(this).css('background-color', 'red');
                },
                header: {
                    left: 'prev,next',
                    center: '',
                    right: 'title'
                },
                // defaultDate: '2016-03-12',
                defaultView: 'month',
                editable: true,
                events: '{% url "series_schedule" series.id %}',
                // events: [{
                //     title: 'Click for Google',
                //     url: 'http://google.com/',
                //     start: '2016-08-28'
                // }]
            });

        });


    })();
</script> -->

<!-- Series Delete Confirmation alerts -->
<script>
  $('.series-delete a').on('click', function(e) {
       e.preventDefault();
          swal({
              title: 'Are you sure?',
              text: 'You will not be able to recover this series.',
              type: 'warning',
              showCancelButton: true,
              confirmButtonColor: '#3085d6',
              cancelButtonColor: '#d33',
              confirmButtonText: 'Yes, delete it!',
              closeOnConfirm: true
          }, function(result) {
              if (result) {
                $(".series-delete").attr("method", "POST").submit();
              } else {
                // do nothing on cancel
            }
          });
        });
</script>

<!-- Note Delete Confirmation -->
<script>
  var form;
  $('.note-delete a').on('click', function(e) {
      form = e.currentTarget.closest("form");
      e.preventDefault();
        swal({
            title: 'Are you sure?',
            text: 'You will not be able to recover this note.',
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!',
            closeOnConfirm: true
        }, function(result) {
            if (result) {
              form.method = "POST";
              form.submit();
            } else {
              // do nothing on cancel
          }
        });
      });
</script>

{% endblock %}

<!-- ================================================= -->
<!-- ================================================= -->
                <!-- MODALS -->
<!-- ================================================= -->
<!-- ================================================= -->

{% block modals %}

<!-- ================================================= -->
          <!-- Add Series Task Modal -->
<!-- ================================================= -->
{% with view.series_tasks as task %}
<div class="modal fade" id="addSeriesTask" tabindex="-1" role="dialog" aria-labelledby="addSeriesTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h5 class="modal-title" id="addTaskModalLabel">Add a task for this series</h5>
            </div>
            <div class="modal-body">
              <form action="{% url 'task_new' %}" method="POST" class="post-form">
              {% csrf_token %}

              <div class="row">
                <div class="col-xs-12">
                      <!-- Name -->
                      <fieldset class="form-group m-b-10">
                        {% comment %}<label class="f-s-12 f-s-400 spread-01 subtle slim-margin">{{ task.form.name.label_tag }}</label>{% endcomment %}
                        {{ task.form.name }}
                        {% if task.form.name.errors %}
                          <small class="text-muted">{{ task.form.name.errors }}</small>
                        {% endif %}
                      </fieldset>
                      <!-- Details -->
                      <fieldset class="form-group m-b-10">
                        {% comment %}<label class="f-s-12 f-s-400 spread-01 subtle slim-margin">{{ task.form.text.label_tag }}</label>{% endcomment %}
                        {{ task.form.text }}
                        {% if task.form.text.errors %}
                          <small class="text-muted">{{ task.form.text.errors }}</small>
                        {% endif %}
                      </fieldset>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12 col-md-6">
                    <!-- Importance -->
                    <fieldset class="form-check m-b-10">
                      <label class="f-s-12 f-s-400 spread-01 subtle slim-margin">{{ task.form.important.label_tag }}</label>
                      {{ task.form.important }}
                      {% if task.form.important.errors %}
                        <small class="text-muted">{{ task.form.important.errors }}</small>
                      {% endif %}
                    </fieldset>
                    <!-- Due Date -->
                    <fieldset class="form-group m-b-10">
                      <label class="f-s-12 f-s-400 spread-01 subtle slim-margin">{{ task.form.due_date.label_tag }}</label>
                      {{ task.form.due_date }}
                      {% if task.form.due_date.errors %}
                        <small class="text-muted">{{ task.form.due_date.errors }}</small>
                      {% endif %}
                    </fieldset>
                </div>
                <div class="col-xs-12 col-md-6">
                    <!-- Assigned To -->
                    <fieldset class="form-group m-b-10">
                      {% comment %}<label class="f-s-12 f-s-400 spread-01 subtle slim-margin">{{ task.form.assigned_to.label_tag }}</label>{% endcomment %}
                      {{ task.form.assigned_to }}
                      {% if task.form.assigned_to.errors %}
                        <small class="text-muted">{{ task.form.assigned_to.errors }}</small>
                      {% endif %}
                    </fieldset>
                    <!-- Status -->
                    <fieldset class="form-group m-b-10">
                      <label class="f-s-12 f-s-400 spread-01 subtle slim-margin">{{ task.form.status.label_tag }}</label>
                      {{ task.form.status }}
                      {% if task.form.status.errors %}
                        <small class="text-muted">{{ task.form.status.errors }}</small>
                      {% endif %}
                    </fieldset>
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12">
                  <input type="hidden" name="series" value="{{ series.pk }}" />
                  <button type="submit" class="btn btn-default">Add Series</button>
                </div>
              </div>

              </form>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
    <script>
      $(".chosen-select").chosen()
    </script>
</div>
{% endwith %}


<!-- ================================================= -->
        <!-- Add / View Series Note Asset Modal -->
<!-- ================================================= -->
{% with view.series_notes as notes %}
<div class="modal fade" id="addSeriesNote" tabindex="-1" role="dialog" aria-labelledby="addSeriesNoteModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h5 class="modal-title" id="addSeriesNoteModalLabel">Add a note for this series</h5>
      </div>
      <div class="modal-body">
        <form action="{% url 'create_seriesnote' %}" method="POST" class="post-form">
        {% csrf_token %}
        {% bootstrap_form notes.form %}
        <!-- Hidden Inputs -->
        <input type="hidden" name="association" value="series" />
        <input type="hidden" name="series" value="{{ series.pk }}" />
        <button type="submit" class="btn btn-default">Post Note</button>
        </form>
      </div>
      <div class="modal-footer">
      </div>
    </div>
  </div>
</div>

  {% for note in notes.notes %}
  <div class="modal fade" id="viewNote{{note.id}}" tabindex="-1" role="dialog" aria-labelledby="viewNote{{note.id}}">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="viewNote{{note.id}}Label">{{ note.title }}</h4>
        </div>
        <div class="modal-body">
          {{ note.text|linebreaksbr }}
        </div>
        <div class="modal-footer">
          <p class="tiny-text">{{ note.owner }} | {{ note.creation_date|date:'D M j g:i a' }}<p>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
{% endwith %}


<!-- ================================================= -->
          <!-- Simple Image Asset Modal -->
<!-- ================================================= -->
{% with view.simple_images as images %}
<div class="modal fade" id="SimpleImageAssetModal" tabindex="-1" role="dialog" aria-labelledby="SimpleImageAssetModal">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="bs-nav-tabs nav-tabs-default">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <ul class="nav nav-tabs nav-animated-border-from-left">
            <li class="nav-item"> <a ng-href="" class="nav-link active" data-toggle="tab" data-target="#uploadimage">Upload a Photo</a></li>
          </ul>
        </div>
        <div class="modal-body" id="imagemodalbody">
          <div class="tab-content">
            <!-- UPLOAD PANEL -->
            <div role="tabpanel" class="tab-pane active" id="uploadimage">
              <div class="uploadpanel" data-toggle="slimScroll" style="height:300px" data-color="#5D9CEC" data-allow-page-scroll="false">
              <form action="{% url 'upload_simple_image' %}" method="POST" class="post-form" enctype="multipart/form-data">
              {% csrf_token %}
              <!-- Left Col -->
              <div class="col-md-6">

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ images.form.photo.label_tag }}</label>
                  {{ images.form.photo }}
                  {% if images.form.photo.errors %}
                    <small class="text-muted">{{ images.form.photo.errors }}</small>
                  {% endif %}
                </fieldset>

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin"><span class="field-label">{{ images.form.title.label_tag }}</label>
                  {{ images.form.title }}
                  {% if images.form.title.errors %}
                    <small class="text-muted">{{ images.form.title.errors }}</small>
                  {% endif %}
                </fieldset>

              </div>
              <!-- End Left Col -->
              <!-- Right Col -->
              <div class="col-md-6">

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ images.form.description.label_tag }}</label>
                  {{ images.form.description }}
                  {% if images.form.description.errors %}
                    <small class="text-muted">{{ images.form.description.errors }}</small>
                  {% endif %}
                </fieldset>


              </div>
              <!-- End Right Col -->
              <!-- ===================================== -->
              <!-- ===================================== -->
              <div class="hidden-image-inputs">
                  <input type="hidden" name="association" value="series" />
                  <input type="hidden" name="series" value="{{ series.pk }}" />
              </div>
              <!-- ===================================== -->
              <!-- ===================================== -->
              <div>
                <button type="submit" class="btn btn-primary m-l-20">Save Image</button>
              </div>
              </form>
              </div>
            </div>
            <!-- END UPLOAD PANEL -->
          </div>
        </div>
        </div>
        <div class="modal-footer"></div>
      </div>
    </div>
  </div>
{% endwith %}


<!-- ================================================= -->
          <!-- Simple Document Asset Modal -->
<!-- ================================================= -->
{% with view.simple_documents as documents %}
<div class="modal fade" id="SimpleDocumentAssetModal" tabindex="-1" role="dialog" aria-labelledby="SimpleDocumentAssetModal">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="bs-nav-tabs nav-tabs-default">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <ul class="nav nav-tabs nav-animated-border-from-left">
            <li class="nav-item"> <a ng-href="" class="nav-link active" data-toggle="tab" data-target="#uploaddocument">Upload a Document</a></li>
          </ul>
        </div>
        <div class="modal-body" id="documentmodalbody">
          <div class="tab-content">
            <!-- UPLOAD PANEL -->
            <div role="tabpanel" class="tab-pane active" id="uploaddocument">
              <div class="uploadpanel" data-toggle="slimScroll" style="height:300px" data-color="#5D9CEC" data-allow-page-scroll="false">
              <form action="{% url 'upload_simple_document' %}" method="POST" class="post-form" enctype="multipart/form-data">
              {% csrf_token %}
              <!-- Left Col -->
              <div class="col-md-6">

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.document.label_tag }}</label>
                  {{ documents.form.document }}
                  {% if documents.form.document.errors %}
                    <small class="text-muted">{{ documents.form.document.errors }}</small>
                  {% endif %}
                </fieldset>

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.title.label_tag }}</label>
                  {{ documents.form.title }}
                  {% if documents.form.title.errors %}
                    <small class="text-muted">{{ documents.form.title.errors }}</small>
                  {% endif %}
                </fieldset>

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.asset_type.label_tag }}</label>
                  {{ documents.form.asset_type }}
                  {% if documents.form.asset_type.errors %}
                    <small class="text-muted">{{ documents.form.asset_type.errors }}</small>
                  {% endif %}
                </fieldset>

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.keywords.label_tag }}</label>
                  {{ documents.form.keywords }}
                  {% if documents.form.keywords.errors %}
                    <small class="text-muted">{{ documents.form.keywords.errors }}</small>
                  {% endif %}
                </fieldset>

              </div>
              <!-- End Left Col -->
              <!-- Right Col -->
              <div class="col-md-6">

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.description.label_tag }}</label>
                  {{ documents.form.description }}
                  {% if documents.form.description.errors %}
                    <small class="text-muted">{{ documents.form.description.errors }}</small>
                  {% endif %}
                </fieldset>

                <fieldset class="form-group m-b-10">
                  <label class="f-s-14 f-s-400 spread-01 subtle slim-margin">{{ documents.form.attribution.label_tag }}</label>
                  {{ documents.form.attribution }}
                  {% if documents.form.attribution.errors %}
                    <small class="text-muted">{{ documents.form.attribution.errors }}</small>
                  {% endif %}
                </fieldset>

              </div>
              <!-- End Right Col -->
              <!-- ===================================== -->
              <!-- ===================================== -->
              <div class="hidden-document-inputs">
                <input type="hidden" name="association" value="series" />
                <input type="hidden" name="series" value="{{ series.pk }}" />
              </div>
              <!-- ===================================== -->
              <!-- ===================================== -->
              <div>
                <button type="submit" class="btn btn-primary m-l-20">Save Document</button>
              </div>
              </form>
              </div>
            </div>
            <!-- END UPLOAD PANEL -->
          </div>
        </div>
        </div>
        <div class="modal-footer"></div>
      </div>
    </div>
  </div>
</div>
{% endwith %}

<!-- ================================================= -->
              <!-- Add Event Modal -->
<!-- ================================================= -->
{% with view.series_events as events %}
<div class="modal fade" id="addEvent" tabindex="-1" role="dialog" aria-labelledby="addEventLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h5 class="modal-title" id="addEventModalLabel">Add an event for this series</h5>
      </div>
      <div class="modal-body">
        <form action="{% url 'event_new' %}" method="POST" class="post-form">
        {% csrf_token %}
        {% bootstrap_form events.form %}
        <!-- Hidden Inputs -->
        <input type="hidden" name="association" value="series" />
        <input type="hidden" name="series" value="{{ series.pk }}" />
        <button type="submit" class="btn btn-default">Save Event</button>
        </form>
      </div>
      <div class="modal-footer">
      </div>
    </div>
  </div>
</div>
{% endwith %}


<!-- ================================================= -->
            <!-- Series Detail Guide Modal -->
<!-- ================================================= -->

{% include "editorial/guides/_series_detail_guide.html" %}


{% endblock modals %}
